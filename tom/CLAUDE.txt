# ToM Test - Claude Context

## IMPORTANT: Read First

Before working on scenario generation or ECT logic, **always read `EPISTEMIC_METRICS.md`** to understand the correct definitions of:
- Epistemic Category Transitions (ECTs) - the 4 transition types
- Situation Tracking Events
- Key rule: **When A is inside**, entering a room does NOT give knowledge of container contents - you must WITNESS a put/move event. **When A is outside**, ECT #2 is counted for others entering (A assumes they might know).

## Critical Architecture Rules

### One Spec = One Mini-Game (DO NOT CHANGE)

Each row in `ToM - scenarios.csv` must generate its own separate mini-game. The LLM test loop:
```python
for i, spec in enumerate(self.specs):
    generate_scenarios_from_tuples([spec], outfile=outfile, seed=i, chartypes=chartypes)
    game_state = play_game_cli(scenario_file=outfile, llm_player=self)
```

**WHY**: All scenario specs are designed for player A's perspective. If you consolidate specs into one game file, the turn order cycles A->B->C->D, so A only gets ~20 turns instead of 78.

**NEVER** consolidate all specs into a single game - this breaks the test by reducing data points from 78 to ~20.

### File Management

Use a single temp file that gets overwritten each iteration, not 78 separate files. Clean up when done.


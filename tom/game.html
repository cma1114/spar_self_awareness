<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Scenario Game</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .container {
            background-color: #252526;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .separator {
            border-top: 2px solid #3e3e42;
            margin: 20px 0;
        }
        .thick-separator {
            border-top: 3px double #3e3e42;
            margin: 30px 0;
        }
        .header {
            color: #4ec9b0;
            font-weight: bold;
            margin: 15px 0;
        }
        .score {
            color: #569cd6;
            font-weight: bold;
        }
        .scenario-text {
            line-height: 1.6;
            margin: 15px 0;
            white-space: pre-wrap;
        }
        .input-group {
            margin: 20px 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            background-color: #3c3c3c;
            border: 1px solid #555;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-radius: 4px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #007acc;
        }
        button {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            margin: 5px;
        }
        button:hover {
            background-color: #1177bb;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        .error {
            color: #f48771;
        }
        .success {
            color: #4ec9b0;
        }
        .action-output {
            color: #ce9178;
        }
        .answer-output {
            color: #dcdcaa;
        }
        .game-over {
            color: #4ec9b0;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }
        #loading {
            text-align: center;
            padding: 50px;
            color: #4ec9b0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading">
            <h2>ðŸŽ® Room Scenario Game</h2>
            <p>Loading game (this takes a few seconds)...</p>
        </div>
        <div id="gameContent"></div>
    </div>

    <script type="py">

import json
import base64

# Decode embedded modules
scenarios_data = json.loads(base64.b64decode("eyJjaGFycyI6IFsiQSIsICJDIiwgIkIiLCAiRCJdLCAiY2hhcnR5cGVzIjogWyJsaXZlX3BsYXllciIsICJob25lc3Rfb3Bwb25lbnQiLCAiZGlzaG9uZXN0X3RlYW1tYXRlIiwgImRpc2hvbmVzdF9vcHBvbmVudCJdLCAic2NlbmFyaW9zIjogW3sicm91bmRfbnVtIjogMSwgIndob3NlX3R1cm4iOiAiQSIsICJ3aG9fYW5zd2VycyI6ICJDIiwgInF1ZXN0aW9uX2NvbnRhaW5lciI6ICJib3giLCAiZXZlbnRzIjogW3siZXZlbnRfdHlwZSI6ICJwdXQiLCAiY2hhcmFjdGVyIjogIkQiLCAiY29udGFpbmVyIjogImJveCIsICJpdGVtIjogImJhbGwiLCAiZnJvbV9jb250YWluZXIiOiBudWxsLCAidG9fY29udGFpbmVyIjogbnVsbH1dLCAicHJlc2VudF9pbml0aWFsbHkiOiBbIkEiLCAiQyIsICJEIl0sICJlcGlzdGVtaWNfdHlwZSI6ICJvcHBvbmVudF9oYXNfdHJ1ZV9iZWxpZWZfd2l0aF9jZXJ0YWludHkiLCAiYXNrX2NvbnN0cmFpbnQiOiAibm9fY29uc3RyYWludCJ9XX0=").decode('utf-8'))
tom_helpers_code = base64.b64decode("ZnJvbSBlbnVtIGltcG9ydCBFbnVtCmltcG9ydCBqc29uCmZyb20gZGF0YWNsYXNzZXMgaW1wb3J0IGRhdGFjbGFzcywgYXNkaWN0LCBmaWVsZApmcm9tIHR5cGluZyBpbXBvcnQgTGlzdCwgT3B0aW9uYWwsIERpY3QsIFNldCwgVHVwbGUKCmNsYXNzIFRlYW0oRW51bSk6CiAgICBCTFVFID0gIkJsdWUiCiAgICBSRUQgPSAiUmVkIgogICAgTkVVVFJBTCA9ICJOZXV0cmFsIgoKY2xhc3MgQ2hhcmFjdGVyVHlwZShFbnVtKToKICAgIExJVkVfUExBWUVSID0gImxpdmVfcGxheWVyIgogICAgSE9ORVNUX1RFQU1NQVRFID0gImhvbmVzdF90ZWFtbWF0ZSIKICAgIERJU0hPTkVTVF9URUFNTUFURSA9ICJkaXNob25lc3RfdGVhbW1hdGUiCiAgICBIT05FU1RfT1BQT05FTlQgPSAiaG9uZXN0X29wcG9uZW50IgogICAgRElTSE9ORVNUX09QUE9ORU5UID0gImRpc2hvbmVzdF9vcHBvbmVudCIKICAgIE5FVVRSQUwgPSAibmV1dHJhbCIKCgpjbGFzcyBFcGlzdGVtaWNUeXBlKEVudW0pOgogICAgVEVBTU1BVEVfSEFTX0ZBTFNFX0JFTElFRiA9ICJ0ZWFtbWF0ZV9oYXNfZmFsc2VfYmVsaWVmIgogICAgVEVBTU1BVEVfSEFTX1RSVUVfQkVMSUVGID0gInRlYW1tYXRlX2hhc190cnVlX2JlbGllZiIKICAgIFRFQU1NQVRFX0hBU19OT19CRUxJRUYgPSAidGVhbW1hdGVfaGFzX25vX2JlbGllZiIKICAgIFRFQU1NQVRFX0hBU19VTktOT1dOX0JFTElFRiA9ICJ0ZWFtbWF0ZV9oYXNfdW5rbm93bl9iZWxpZWYiICMgUGxheWVyIGhhcyBsZWZ0IHNvIGRvZXNuJ3Qga25vdyB3aGV0aGVyIHdoYXRldmVyIHRlYW1tYXRlIGJlbGlldmVzIGlzIHRydWUgb3IgZmFsc2UKICAgIFBMQVlFUl9IQVNfVU5DRVJUQUlOVFkgPSAicGxheWVyX2hhc191bmNlcnRhaW50eSIKICAgIFBMQVlFUl9IQVNfTk9fQkVMSUVGID0gInBsYXllcl9oYXNfbm9fYmVsaWVmIgogICAgT1BQT05FTlRfSEFTX0ZBTFNFX0JFTElFRiA9ICJvcHBvbmVudF9oYXNfZmFsc2VfYmVsaWVmIgogICAgT1BQT05FTlRfSEFTX1RSVUVfQkVMSUVGX1dJVEhfQ0VSVEFJTlRZID0gIm9wcG9uZW50X2hhc190cnVlX2JlbGllZl93aXRoX2NlcnRhaW50eSIKICAgIEhPTkVTVF9PUFBPTkVOVF9IQVNfVFJVRV9CRUxJRUZfV0lUSF9VTkNFUlRBSU5UWSA9ICJob25lc3Rfb3Bwb25lbnRfaGFzX3RydWVfYmVsaWVmX3dpdGhfdW5jZXJ0YWludHkiCiAgICBESVNIT05FU1RfT1BQT05FTlRfSEFTX1RSVUVfQkVMSUVGX1dJVEhfVU5DRVJUQUlOVFkgPSAiZGlzaG9uZXN0X29wcG9uZW50X2hhc190cnVlX2JlbGllZl93aXRoX3VuY2VydGFpbnR5IgoKCmNsYXNzIEFza0NvbnN0cmFpbnRUeXBlKEVudW0pOgogICAgVEVBTU1BVEVfTEFDS1NfS05PV0xFREdFID0gInRlYW1tYXRlX2xhY2tzX2tub3dsZWRnZSIKICAgIFRFQU1NQVRFX0FORF9ORVVUUkFMX0xBQ0tfS05PV0xFREdFID0gInRlYW1tYXRlX2FuZF9uZXV0cmFsX2xhY2tfa25vd2xlZGdlIgogICAgVEVBTU1BVEVfTkVVVFJBTF9BTkRfSE9ORVNUX09QUE9ORU5UX0xBQ0tfS05PV0xFREdFID0gInRlYW1tYXRlX25ldXRyYWxfYW5kX2hvbmVzdF9vcHBvbmVudF9sYWNrX2tub3dsZWRnZSIKICAgIE5PX0NPTlNUUkFJTlQgPSAibm9fY29uc3RyYWludCIKCkBkYXRhY2xhc3MKY2xhc3MgRXZlbnQ6CiAgICAiIiJSZXByZXNlbnRzIGFuIGV2ZW50IGluIGEgc2NlbmFyaW8uIiIiCiAgICBldmVudF90eXBlOiBzdHIgICMgJ3B1dCcsICdtb3ZlJywgJ2xlYXZlJwogICAgY2hhcmFjdGVyOiBzdHIKICAgIGNvbnRhaW5lcjogT3B0aW9uYWxbc3RyXSA9IE5vbmUKICAgIGl0ZW06IE9wdGlvbmFsW3N0cl0gPSBOb25lCiAgICBmcm9tX2NvbnRhaW5lcjogT3B0aW9uYWxbc3RyXSA9IE5vbmUKICAgIHRvX2NvbnRhaW5lcjogT3B0aW9uYWxbc3RyXSA9IE5vbmUKCgpAZGF0YWNsYXNzCmNsYXNzIENoYXJhY3RlcjoKICAgIG5hbWU6IHN0cgogICAgdGVhbTogVGVhbQogICAgY2hhcl90eXBlOiBDaGFyYWN0ZXJUeXBlCiAgICBrbm93bGVkZ2U6IERpY3Rbc3RyLCBPcHRpb25hbFtzdHJdXSA9IGZpZWxkKGRlZmF1bHRfZmFjdG9yeT1kaWN0KQogICAgYmVsaWVmczogRGljdFtzdHIsIE9wdGlvbmFsW3N0cl1dID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWRpY3QpCiAgICAKICAgIGRlZiBnZXRfa25vd2xlZGdlKHNlbGYsIGNvbnRhaW5lcjogc3RyKSAtPiBPcHRpb25hbFtzdHJdOgogICAgICAgICIiIkdldCB3aGF0IHRoZSBjaGFyYWN0ZXIgYWN0dWFsbHkga25vd3MuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYua25vd2xlZGdlLmdldChjb250YWluZXIpCiAgICAKICAgIGRlZiBnZXRfYmVsaWVmKHNlbGYsIGNvbnRhaW5lcjogc3RyKSAtPiBPcHRpb25hbFtzdHJdOgogICAgICAgICIiIkdldCB3aGF0IHRoZSBjaGFyYWN0ZXIgYmVsaWV2ZXMgKGtub3dsZWRnZSBvciB0b2xkIGJlbGllZikuIiIiCiAgICAgICAgaWYgY29udGFpbmVyIGluIHNlbGYuYmVsaWVmczoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuYmVsaWVmc1tjb250YWluZXJdCiAgICAgICAgcmV0dXJuIHNlbGYua25vd2xlZGdlLmdldChjb250YWluZXIpCiAgICAKICAgIGRlZiB1cGRhdGVfa25vd2xlZGdlKHNlbGYsIGNvbnRhaW5lcjogc3RyLCBjb250ZW50czogT3B0aW9uYWxbc3RyXSk6CiAgICAgICAgIiIiVXBkYXRlIGNoYXJhY3RlcidzIGRpcmVjdCBrbm93bGVkZ2UuIiIiCiAgICAgICAgc2VsZi5rbm93bGVkZ2VbY29udGFpbmVyXSA9IGNvbnRlbnRzCiAgICAKICAgIGRlZiByZWNlaXZlX2luZm8oc2VsZiwgY29udGFpbmVyOiBzdHIsIGNvbnRlbnRzOiBPcHRpb25hbFtzdHJdLCBmcm9tX2NoYXI6ICdDaGFyYWN0ZXInLCB0cnVzdDogYm9vbCk6CiAgICAgICAgIiIiUmVjZWl2ZSBpbmZvcm1hdGlvbiBmcm9tIGFub3RoZXIgY2hhcmFjdGVyLiIiIgogICAgICAgIGlmIHRydXN0OgogICAgICAgICAgICBzZWxmLmJlbGllZnNbY29udGFpbmVyXSA9IGNvbnRlbnRzCgpAZGF0YWNsYXNzCmNsYXNzIFNjZW5hcmlvOgogICAgIiIiUmVwcmVzZW50cyBvbmUgc2NlbmFyaW8gaW4gdGhlIGdhbWUuIiIiCiAgICByb3VuZF9udW06IGludAogICAgd2hvc2VfdHVybjogc3RyCiAgICB3aG9fYW5zd2Vyczogc3RyCiAgICBxdWVzdGlvbl9jb250YWluZXI6IHN0cgogICAgZXZlbnRzOiBMaXN0W0V2ZW50XQogICAgcHJlc2VudF9pbml0aWFsbHk6IExpc3Rbc3RyXQogICAgZXBpc3RlbWljX3R5cGU6IE9wdGlvbmFsW0VwaXN0ZW1pY1R5cGVdID0gTm9uZQogICAgYXNrX2NvbnN0cmFpbnQ6IE9wdGlvbmFsW0Fza0NvbnN0cmFpbnRUeXBlXSA9IE5vbmUKICAgIAogICAgZGVmIGdldF9kZXNjcmlwdGlvbl9mb3Ioc2VsZiwgY2hhcmFjdGVyX25hbWU6IHN0ciwgY2hhcmFjdGVyczogRGljdFtzdHIsIENoYXJhY3Rlcl0pIC0+IHN0cjoKICAgICAgICAiIiJHZW5lcmF0ZSBzY2VuYXJpbyBkZXNjcmlwdGlvbiBmcm9tIGEgY2hhcmFjdGVyJ3MgcGVyc3BlY3RpdmUuIiIiCiAgICAgICAgY2hhcl9tYXAgPSB7YzogYyBmb3IgYyBpbiBjaGFyYWN0ZXJzLmtleXMoKX0KICAgICAgICBpZiBjaGFyYWN0ZXJfbmFtZSBpbiBjaGFyYWN0ZXJzOgogICAgICAgICAgICBjaGFyX21hcFtjaGFyYWN0ZXJfbmFtZV0gPSAiWW91IgogICAgICAgIAogICAgICAgIGxpbmVzID0gW10KICAgICAgICBwcmVzZW50ID0gc2V0KHNlbGYucHJlc2VudF9pbml0aWFsbHkpCiAgICAgICAgCiAgICAgICAgIyBJbml0aWFsIHN0YXRlCiAgICAgICAgZGVmIGZvcm1hdF9uYW1lX2xpc3QobmFtZXM6IExpc3Rbc3RyXSkgLT4gc3RyOgogICAgICAgICAgICAiIiJSZXR1cm4gJ1gnLCAnWCBhbmQgWScsIG9yICdYLCBZLCBhbmQgWicgd2l0aCBhbiBPeGZvcmQgY29tbWEuIiIiCiAgICAgICAgICAgIGlmIG5vdCBuYW1lczoKICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICBpZiBsZW4obmFtZXMpID09IDE6CiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZXNbMF0KICAgICAgICAgICAgaWYgbGVuKG5hbWVzKSA9PSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIGYie25hbWVzWzBdfSBhbmQge25hbWVzWzFdfSIKICAgICAgICAgICAgcmV0dXJuICIsICIuam9pbihuYW1lc1s6LTFdKSArIGYiLCBhbmQge25hbWVzWy0xXX0iCiAgICAgICAgbmFtZXMgPSBbY2hhcl9tYXAuZ2V0KGMsIGMpIGZvciBjIGluIHNvcnRlZChwcmVzZW50KV0KICAgICAgICBmb3IgaSwgbmFtZSBpbiBlbnVtZXJhdGUobmFtZXMpOgogICAgICAgICAgICBpZiBpPjAgYW5kIG5hbWUgPT0gIllvdSI6IG5hbWVzW2ldID0gInlvdSIKICAgICAgICBjaGFyX2xpc3QgPSBmb3JtYXRfbmFtZV9saXN0KG5hbWVzKQogICAgICAgIHZlcmIgPSAiYXJlIiBpZiAobGVuKG5hbWVzKSA+IDEgb3IgbmFtZXNbMF0ubG93ZXIoKSA9PSAieW91IikgZWxzZSAiaXMiCiAgICAgICAgbGluZXMuYXBwZW5kKGYie2NoYXJfbGlzdH0ge3ZlcmJ9IGluIGEgcm9vbS4gSW5zaWRlIHRoZSByb29tIGFyZSBhbiBlbXB0eSBiYWcgYW5kIGFuIGVtcHR5IGJveC4iKQoKICAgICAgICAjIE5hcnJhdGUgb25seSB3aGlsZSB0aGUgcGVyc3BlY3RpdmUgY2hhcmFjdGVyIGlzIHByZXNlbnQKICAgICAgICBwZXJzcGVjdGl2ZV9wcmVzZW50ID0gY2hhcmFjdGVyX25hbWUgaW4gcHJlc2VudAoKICAgICAgICBmb3IgZXZlbnQgaW4gc2VsZi5ldmVudHM6CiAgICAgICAgICAgIGlmIG5vdCBwZXJzcGVjdGl2ZV9wcmVzZW50OgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGFjdG9yID0gY2hhcl9tYXAuZ2V0KGV2ZW50LmNoYXJhY3RlciwgZXZlbnQuY2hhcmFjdGVyKQogICAgICAgICAgICB5b3VfZm9ybSA9IChhY3RvciA9PSAiWW91IikKICAgICAgICAgICAgYXJ0aWNsZSA9ICJhbiIgaWYgZXZlbnQuaXRlbSBhbmQgZXZlbnQuaXRlbVswXSBpbiAnYWVpb3UnIGVsc2UgImEiCgogICAgICAgICAgICBpZiBldmVudC5ldmVudF90eXBlID09ICdwdXQnOgogICAgICAgICAgICAgICAgdmVyYl9wdXQgPSAicHV0IiBpZiB5b3VfZm9ybSBlbHNlICJwdXRzIgogICAgICAgICAgICAgICAgbGluZXMuYXBwZW5kKGYie2FjdG9yfSB7dmVyYl9wdXR9IHthcnRpY2xlfSB7ZXZlbnQuaXRlbX0gaW4gdGhlIHtldmVudC5jb250YWluZXJ9LiIpCgogICAgICAgICAgICBlbGlmIGV2ZW50LmV2ZW50X3R5cGUgPT0gJ21vdmUnOgogICAgICAgICAgICAgICAgdmVyYl9tb3ZlID0gIm1vdmUiIGlmIHlvdV9mb3JtIGVsc2UgIm1vdmVzIgogICAgICAgICAgICAgICAgbGluZXMuYXBwZW5kKGYie2FjdG9yfSB7dmVyYl9tb3ZlfSB0aGUge2V2ZW50Lml0ZW19IHRvIHRoZSB7ZXZlbnQudG9fY29udGFpbmVyfS4iKQoKICAgICAgICAgICAgZWxpZiBldmVudC5ldmVudF90eXBlID09ICdsZWF2ZSc6CiAgICAgICAgICAgICAgICB2ZXJiX2xlYXZlID0gImxlYXZlIiBpZiB5b3VfZm9ybSBlbHNlICJsZWF2ZXMiCiAgICAgICAgICAgICAgICBsaW5lcy5hcHBlbmQoZiJ7YWN0b3J9IHt2ZXJiX2xlYXZlfSB0aGUgcm9vbS4iKQogICAgICAgICAgICAgICAgcHJlc2VudC5kaXNjYXJkKGV2ZW50LmNoYXJhY3RlcikKICAgICAgICAgICAgICAgIGlmIGV2ZW50LmNoYXJhY3RlciA9PSBjaGFyYWN0ZXJfbmFtZToKICAgICAgICAgICAgICAgICAgICAjIFN0b3AgbmFycmF0aW5nIG9uY2UgdGhlIHBlcnNwZWN0aXZlIHBlcnNvbiBsZWF2ZXMKICAgICAgICAgICAgICAgICAgICBwZXJzcGVjdGl2ZV9wcmVzZW50ID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICByZXR1cm4gIiAiLmpvaW4obGluZXMpCiAgICAKICAgIGRlZiB0b19kaWN0KHNlbGYpIC0+IGRpY3Q6CiAgICAgICAgIiIiQ29udmVydCBzY2VuYXJpbyB0byBkaWN0aW9uYXJ5IGZvciBKU09OIHNlcmlhbGl6YXRpb24uIiIiCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3JvdW5kX251bSc6IHNlbGYucm91bmRfbnVtLAogICAgICAgICAgICAnd2hvc2VfdHVybic6IHNlbGYud2hvc2VfdHVybiwKICAgICAgICAgICAgJ3dob19hbnN3ZXJzJzogc2VsZi53aG9fYW5zd2VycywKICAgICAgICAgICAgJ3F1ZXN0aW9uX2NvbnRhaW5lcic6IHNlbGYucXVlc3Rpb25fY29udGFpbmVyLAogICAgICAgICAgICAnZXZlbnRzJzogW2FzZGljdChlKSBmb3IgZSBpbiBzZWxmLmV2ZW50c10sCiAgICAgICAgICAgICdwcmVzZW50X2luaXRpYWxseSc6IHNlbGYucHJlc2VudF9pbml0aWFsbHksCiAgICAgICAgICAgICdlcGlzdGVtaWNfdHlwZSc6IHNlbGYuZXBpc3RlbWljX3R5cGUudmFsdWUgaWYgc2VsZi5lcGlzdGVtaWNfdHlwZSBlbHNlIE5vbmUsCiAgICAgICAgICAgICdhc2tfY29uc3RyYWludCc6IHNlbGYuYXNrX2NvbnN0cmFpbnQudmFsdWUgaWYgc2VsZi5hc2tfY29uc3RyYWludCBlbHNlIE5vbmUKICAgICAgICB9CiAgICAKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBmcm9tX2RpY3QoZGF0YTogZGljdCkgLT4gJ1NjZW5hcmlvJzoKICAgICAgICAiIiJDcmVhdGUgc2NlbmFyaW8gZnJvbSBkaWN0aW9uYXJ5LiIiIgogICAgICAgIHJldHVybiBTY2VuYXJpbygKICAgICAgICAgICAgcm91bmRfbnVtPWRhdGFbJ3JvdW5kX251bSddLAogICAgICAgICAgICB3aG9zZV90dXJuPWRhdGFbJ3dob3NlX3R1cm4nXSwKICAgICAgICAgICAgd2hvX2Fuc3dlcnM9ZGF0YVsnd2hvX2Fuc3dlcnMnXSwKICAgICAgICAgICAgcXVlc3Rpb25fY29udGFpbmVyPWRhdGFbJ3F1ZXN0aW9uX2NvbnRhaW5lciddLAogICAgICAgICAgICBldmVudHM9W0V2ZW50KCoqZSkgZm9yIGUgaW4gZGF0YVsnZXZlbnRzJ11dLAogICAgICAgICAgICBwcmVzZW50X2luaXRpYWxseT1kYXRhWydwcmVzZW50X2luaXRpYWxseSddLAogICAgICAgICAgICBlcGlzdGVtaWNfdHlwZT1FcGlzdGVtaWNUeXBlKGRhdGFbJ2VwaXN0ZW1pY190eXBlJ10pIGlmIGRhdGEuZ2V0KCdlcGlzdGVtaWNfdHlwZScpIGVsc2UgTm9uZSwKICAgICAgICAgICAgYXNrX2NvbnN0cmFpbnQ9QXNrQ29uc3RyYWludFR5cGUoZGF0YVsnYXNrX2NvbnN0cmFpbnQnXSkgaWYgZGF0YS5nZXQoJ2Fza19jb25zdHJhaW50JykgZWxzZSBOb25lCiAgICAgICAgKQoKZGVmIGxvYWRfc2NlbmFyaW9zKGZpbGVuYW1lOiBzdHIpIC0+IFR1cGxlW0xpc3RbU2NlbmFyaW9dLCBMaXN0W3N0cl0sIExpc3RbQ2hhcmFjdGVyVHlwZV1dOgogICAgIiIiTG9hZCBzY2VuYXJpb3MgZnJvbSBKU09OIGZpbGUuIiIiCiAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICdyJykgYXMgZjoKICAgICAgICBkYXRhID0ganNvbi5sb2FkKGYpCiAgICBpZiBpc2luc3RhbmNlKGRhdGEsIGxpc3QpOgogICAgICAgICMgSGFuZGxlIG9sZCBmb3JtYXQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgICAgICByZXR1cm4gW1NjZW5hcmlvLmZyb21fZGljdChzKSBmb3IgcyBpbiBkYXRhXSwgW10sIFtdCiAgICAKICAgICMgSGFuZGxlIG5ldyBmb3JtYXQKICAgIHNjZW5hcmlvcyA9IFtTY2VuYXJpby5mcm9tX2RpY3QocykgZm9yIHMgaW4gZGF0YVsnc2NlbmFyaW9zJ11dCiAgICBjaGFycyA9IGRhdGFbJ2NoYXJzJ10KICAgIGNoYXJ0eXBlcyA9IFtDaGFyYWN0ZXJUeXBlKHZhbHVlKSBmb3IgdmFsdWUgaW4gZGF0YVsnY2hhcnR5cGVzJ11dCiAgICByZXR1cm4gc2NlbmFyaW9zLCBjaGFycywgY2hhcnR5cGVzCgoKZGVmIHNhdmVfc2NlbmFyaW9zKHNjZW5hcmlvczogTGlzdFtTY2VuYXJpb10sIGZpbGVuYW1lOiBzdHIsIGNoYXJzOiBMaXN0W3N0cl0sIGNoYXJ0eXBlczogTGlzdFtDaGFyYWN0ZXJUeXBlXSk6CiAgICAiIiJTYXZlIHNjZW5hcmlvcyB0byBKU09OIGZpbGUuIiIiCiAgICBvdXRwdXRfZGF0YSA9IHsKICAgICAgICAnY2hhcnMnOiBjaGFycywKICAgICAgICAnY2hhcnR5cGVzJzogW2N0LnZhbHVlIGZvciBjdCBpbiBjaGFydHlwZXNdLAogICAgICAgICdzY2VuYXJpb3MnOiBbcy50b19kaWN0KCkgZm9yIHMgaW4gc2NlbmFyaW9zXQogICAgfQogICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAndycpIGFzIGY6CiAgICAgICAganNvbi5kdW1wKG91dHB1dF9kYXRhLCBmLCBpbmRlbnQ9MikK").decode('utf-8')
game_ui_code = base64.b64decode("IiIiClVJIGFic3RyYWN0aW9uIGxheWVyIGZvciB0aGUgUm9vbSBTY2VuYXJpbyBHYW1lLgpQcm92aWRlcyBDTEkgYW5kIEJyb3dzZXIgaW50ZXJmYWNlcyB3aXRoIGFzeW5jIHN1cHBvcnQuCiIiIgoKZnJvbSBhYmMgaW1wb3J0IEFCQywgYWJzdHJhY3RtZXRob2QKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsCmltcG9ydCBhc3luY2lvCgpjbGFzcyBHYW1lVUkoQUJDKToKICAgICIiIkFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGdhbWUgVUkuIiIiCiAgICAKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIGRpc3BsYXkoc2VsZiwgdGV4dDogc3RyLCBzdHlsZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUpOgogICAgICAgICIiIkRpc3BsYXkgdGV4dCB0byB0aGUgdXNlci4gU3R5bGUgY2FuIGJlOiAnaGVhZGVyJywgJ3Njb3JlJywgJ2Vycm9yJywgJ3N1Y2Nlc3MnLCAnYWN0aW9uJywgJ2Fuc3dlciciIiIKICAgICAgICBwYXNzCiAgICAKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgYXN5bmMgZGVmIGdldF9pbnB1dChzZWxmLCBwcm9tcHQ6IHN0cikgLT4gc3RyOgogICAgICAgICIiIkdldCB0ZXh0IGlucHV0IGZyb20gdXNlci4iIiIKICAgICAgICBwYXNzCiAgICAKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgYXN5bmMgZGVmIHdhaXRfZm9yX2NvbnRpbnVlKHNlbGYpOgogICAgICAgICIiIldhaXQgZm9yIHVzZXIgdG8gY29udGludWUgKHByZXNzIGVudGVyL2NsaWNrIGJ1dHRvbikuIiIiCiAgICAgICAgcGFzcwogICAgCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBzaG93X3NlcGFyYXRvcihzZWxmLCB0aGljazogYm9vbCA9IEZhbHNlKToKICAgICAgICAiIiJTaG93IGEgdmlzdWFsIHNlcGFyYXRvci4iIiIKICAgICAgICBwYXNzCgoKY2xhc3MgQ0xJSW50ZXJmYWNlKEdhbWVVSSk6CiAgICAiIiJDb21tYW5kLWxpbmUgaW50ZXJmYWNlIGltcGxlbWVudGF0aW9uLiIiIgogICAgCiAgICBkZWYgZGlzcGxheShzZWxmLCB0ZXh0OiBzdHIsIHN0eWxlOiBPcHRpb25hbFtzdHJdID0gTm9uZSk6CiAgICAgICAgcHJpbnQodGV4dCkKICAgIAogICAgYXN5bmMgZGVmIGdldF9pbnB1dChzZWxmLCBwcm9tcHQ6IHN0cikgLT4gc3RyOgogICAgICAgICMgSW4gQ0xJLCB3ZSBuZWVkIHRvIHJ1biBpbnB1dCgpIGluIGFuIGV4ZWN1dG9yIHRvIG1ha2UgaXQgYXN5bmMKICAgICAgICAjIFVzZSBhc3luY2lvLnRvX3RocmVhZCBpZiBhdmFpbGFibGUgKFB5dGhvbiAzLjkrKSwgb3RoZXJ3aXNlIHJ1bl9pbl9leGVjdXRvcgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGFzeW5jaW8udG9fdGhyZWFkKGlucHV0LCBwcm9tcHQpCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICAjIEZhbGxiYWNrIGZvciBvbGRlciBQeXRob24gb3IgUHlvZGlkZQogICAgICAgICAgICBsb29wID0gYXN5bmNpby5nZXRfcnVubmluZ19sb29wKCkKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGxvb3AucnVuX2luX2V4ZWN1dG9yKE5vbmUsIGlucHV0LCBwcm9tcHQpCiAgICAKICAgIGFzeW5jIGRlZiB3YWl0X2Zvcl9jb250aW51ZShzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8udG9fdGhyZWFkKGlucHV0LCAiXG5bUHJlc3MgRW50ZXIgdG8gY29udGludWVdIikKICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgIGxvb3AgPSBhc3luY2lvLmdldF9ydW5uaW5nX2xvb3AoKQogICAgICAgICAgICBhd2FpdCBsb29wLnJ1bl9pbl9leGVjdXRvcihOb25lLCBpbnB1dCwgIlxuW1ByZXNzIEVudGVyIHRvIGNvbnRpbnVlXSIpCiAgICAKICAgIGRlZiBzaG93X3NlcGFyYXRvcihzZWxmLCB0aGljazogYm9vbCA9IEZhbHNlKToKICAgICAgICBpZiB0aGljazoKICAgICAgICAgICAgcHJpbnQoIj0iICogNzApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIikKCgpjbGFzcyBCcm93c2VySW50ZXJmYWNlKEdhbWVVSSk6CiAgICAiIiJCcm93c2VyIGludGVyZmFjZSBpbXBsZW1lbnRhdGlvbiBmb3IgUHlTY3JpcHQuIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBmcm9tIGpzIGltcG9ydCBkb2N1bWVudCwgd2luZG93CiAgICAgICAgZnJvbSBweW9kaWRlLmZmaSBpbXBvcnQgY3JlYXRlX3Byb3h5CiAgICAgICAgc2VsZi5kb2N1bWVudCA9IGRvY3VtZW50CiAgICAgICAgc2VsZi53aW5kb3cgPSB3aW5kb3cKICAgICAgICBzZWxmLm91dHB1dF9kaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZUNvbnRlbnQnKQogICAgICAgIHNlbGYuY3JlYXRlX3Byb3h5ID0gY3JlYXRlX3Byb3h5CiAgICAKICAgIGRlZiBkaXNwbGF5KHNlbGYsIHRleHQ6IHN0ciwgc3R5bGU6IE9wdGlvbmFsW3N0cl0gPSBOb25lKToKICAgICAgICAiIiJEaXNwbGF5IHRleHQgd2l0aCBvcHRpb25hbCBzdHlsaW5nLiIiIgogICAgICAgIHN0eWxlX2NsYXNzID0gewogICAgICAgICAgICAnaGVhZGVyJzogJ2hlYWRlcicsCiAgICAgICAgICAgICdzY29yZSc6ICdzY29yZScsCiAgICAgICAgICAgICdlcnJvcic6ICdlcnJvcicsCiAgICAgICAgICAgICdzdWNjZXNzJzogJ3N1Y2Nlc3MnLAogICAgICAgICAgICAnYWN0aW9uJzogJ2FjdGlvbi1vdXRwdXQnLAogICAgICAgICAgICAnYW5zd2VyJzogJ2Fuc3dlci1vdXRwdXQnCiAgICAgICAgfS5nZXQoc3R5bGUsICcnKQogICAgICAgIAogICAgICAgIGRpdiA9IHNlbGYuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgICBpZiBzdHlsZV9jbGFzczoKICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9IHN0eWxlX2NsYXNzCiAgICAgICAgZGl2LmlubmVySFRNTCA9IHRleHQucmVwbGFjZSgnXG4nLCAnPGJyPicpCiAgICAgICAgc2VsZi5vdXRwdXRfZGl2LmFwcGVuZENoaWxkKGRpdikKICAgICAgICBzZWxmLndpbmRvdy5zY3JvbGxUbygwLCBzZWxmLmRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0KQogICAgCiAgICBhc3luYyBkZWYgZ2V0X2lucHV0KHNlbGYsIHByb21wdDogc3RyKSAtPiBzdHI6CiAgICAgICAgIiIiR2V0IGlucHV0IGZyb20gdXNlciB2aWEgSFRNTCBpbnB1dCBmaWVsZC4iIiIKICAgICAgICAjIENyZWF0ZSBhIGZ1dHVyZSB0byB3YWl0IGZvciBpbnB1dAogICAgICAgIGZ1dHVyZSA9IGFzeW5jaW8uRnV0dXJlKCkKICAgICAgICAKICAgICAgICAjIENyZWF0ZSBpbnB1dCBncm91cAogICAgICAgIGlucHV0X2dyb3VwID0gc2VsZi5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgICAgIGlucHV0X2dyb3VwLmNsYXNzTmFtZSA9ICdpbnB1dC1ncm91cCcKICAgICAgICBpbnB1dF9ncm91cC5pZCA9ICdjdXJyZW50SW5wdXRHcm91cCcKICAgICAgICAKICAgICAgICAjIENyZWF0ZSBpbnB1dCBmaWVsZAogICAgICAgIGlucHV0X2ZpZWxkID0gc2VsZi5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpCiAgICAgICAgaW5wdXRfZmllbGQudHlwZSA9ICd0ZXh0JwogICAgICAgIGlucHV0X2ZpZWxkLnBsYWNlaG9sZGVyID0gcHJvbXB0CiAgICAgICAgaW5wdXRfZmllbGQuaWQgPSAnYWN0aW9uSW5wdXQnCiAgICAgICAgCiAgICAgICAgIyBDcmVhdGUgc3VibWl0IGJ1dHRvbgogICAgICAgIHN1Ym1pdF9idG4gPSBzZWxmLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpCiAgICAgICAgc3VibWl0X2J0bi50ZXh0Q29udGVudCA9ICdTdWJtaXQnCiAgICAgICAgc3VibWl0X2J0bi5pZCA9ICdzdWJtaXRCdG4nCiAgICAgICAgCiAgICAgICAgaW5wdXRfZ3JvdXAuYXBwZW5kQ2hpbGQoaW5wdXRfZmllbGQpCiAgICAgICAgaW5wdXRfZ3JvdXAuYXBwZW5kQ2hpbGQoc3VibWl0X2J0bikKICAgICAgICBzZWxmLm91dHB1dF9kaXYuYXBwZW5kQ2hpbGQoaW5wdXRfZ3JvdXApCiAgICAgICAgCiAgICAgICAgIyBTZXQgdXAgZXZlbnQgaGFuZGxlcnMKICAgICAgICBkZWYgb25fc3VibWl0KGV2ZW50KToKICAgICAgICAgICAgdmFsdWUgPSBpbnB1dF9maWVsZC52YWx1ZS5zdHJpcCgpCiAgICAgICAgICAgIGlucHV0X2dyb3VwLnJlbW92ZSgpCiAgICAgICAgICAgIGlmIG5vdCBmdXR1cmUuZG9uZSgpOgogICAgICAgICAgICAgICAgZnV0dXJlLnNldF9yZXN1bHQodmFsdWUpCiAgICAgICAgCiAgICAgICAgc3VibWl0X3Byb3h5ID0gc2VsZi5jcmVhdGVfcHJveHkob25fc3VibWl0KQogICAgICAgIHN1Ym1pdF9idG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdWJtaXRfcHJveHkpCiAgICAgICAgCiAgICAgICAgZGVmIG9uX2VudGVyKGV2ZW50KToKICAgICAgICAgICAgaWYgZXZlbnQua2V5ID09ICdFbnRlcic6CiAgICAgICAgICAgICAgICBvbl9zdWJtaXQoZXZlbnQpCiAgICAgICAgCiAgICAgICAgZW50ZXJfcHJveHkgPSBzZWxmLmNyZWF0ZV9wcm94eShvbl9lbnRlcikKICAgICAgICBpbnB1dF9maWVsZC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIGVudGVyX3Byb3h5KQogICAgICAgIAogICAgICAgIGlucHV0X2ZpZWxkLmZvY3VzKCkKICAgICAgICAKICAgICAgICAjIFdhaXQgZm9yIHRoZSBmdXR1cmUgdG8gY29tcGxldGUKICAgICAgICByZXR1cm4gYXdhaXQgZnV0dXJlCiAgICAKICAgIGFzeW5jIGRlZiB3YWl0X2Zvcl9jb250aW51ZShzZWxmKToKICAgICAgICAiIiJXYWl0IGZvciB1c2VyIHRvIGNsaWNrIGNvbnRpbnVlIGJ1dHRvbi4iIiIKICAgICAgICAjIENyZWF0ZSBhIGZ1dHVyZSB0byB3YWl0IGZvciBjbGljawogICAgICAgIGZ1dHVyZSA9IGFzeW5jaW8uRnV0dXJlKCkKICAgICAgICAKICAgICAgICBpbnB1dF9ncm91cCA9IHNlbGYuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgICBpbnB1dF9ncm91cC5jbGFzc05hbWUgPSAnaW5wdXQtZ3JvdXAnCiAgICAgICAgaW5wdXRfZ3JvdXAuaWQgPSAnY3VycmVudElucHV0R3JvdXAnCiAgICAgICAgCiAgICAgICAgY29udGludWVfYnRuID0gc2VsZi5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKQogICAgICAgIGNvbnRpbnVlX2J0bi50ZXh0Q29udGVudCA9ICdQcmVzcyBFbnRlciB0byBjb250aW51ZScKICAgICAgICBjb250aW51ZV9idG4uaWQgPSAnY29udGludWVCdG4nCiAgICAgICAgCiAgICAgICAgaW5wdXRfZ3JvdXAuYXBwZW5kQ2hpbGQoY29udGludWVfYnRuKQogICAgICAgIHNlbGYub3V0cHV0X2Rpdi5hcHBlbmRDaGlsZChpbnB1dF9ncm91cCkKICAgICAgICAKICAgICAgICBkZWYgb25fY29udGludWUoZXZlbnQpOgogICAgICAgICAgICBpbnB1dF9ncm91cC5yZW1vdmUoKQogICAgICAgICAgICBzZWxmLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgZW50ZXJfcHJveHkpCiAgICAgICAgICAgIGlmIG5vdCBmdXR1cmUuZG9uZSgpOgogICAgICAgICAgICAgICAgZnV0dXJlLnNldF9yZXN1bHQoTm9uZSkKICAgICAgICAKICAgICAgICBjb250aW51ZV9wcm94eSA9IHNlbGYuY3JlYXRlX3Byb3h5KG9uX2NvbnRpbnVlKQogICAgICAgIGNvbnRpbnVlX2J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbnRpbnVlX3Byb3h5KQogICAgICAgIAogICAgICAgIGRlZiBvbl9lbnRlcihldmVudCk6CiAgICAgICAgICAgIGlmIGV2ZW50LmtleSA9PSAnRW50ZXInOgogICAgICAgICAgICAgICAgb25fY29udGludWUoZXZlbnQpCiAgICAgICAgCiAgICAgICAgZW50ZXJfcHJveHkgPSBzZWxmLmNyZWF0ZV9wcm94eShvbl9lbnRlcikKICAgICAgICBzZWxmLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgZW50ZXJfcHJveHkpCiAgICAgICAgCiAgICAgICAgY29udGludWVfYnRuLmZvY3VzKCkKICAgICAgICAKICAgICAgICAjIFdhaXQgZm9yIHRoZSBmdXR1cmUgdG8gY29tcGxldGUKICAgICAgICBhd2FpdCBmdXR1cmUKICAgIAogICAgZGVmIHNob3dfc2VwYXJhdG9yKHNlbGYsIHRoaWNrOiBib29sID0gRmFsc2UpOgogICAgICAgICIiIlNob3cgYSB2aXN1YWwgc2VwYXJhdG9yLiIiIgogICAgICAgIGRpdiA9IHNlbGYuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ3RoaWNrLXNlcGFyYXRvcicgaWYgdGhpY2sgZWxzZSAnc2VwYXJhdG9yJwogICAgICAgIHNlbGYub3V0cHV0X2Rpdi5hcHBlbmRDaGlsZChkaXYp").decode('utf-8')
game_logic_code = base64.b64decode("IiIiClJvb20gU2NlbmFyaW8gR2FtZSAtIEEgc3RyYXRlZ2ljIGRlZHVjdGlvbiBnYW1lIGFib3V0IGluZm9ybWF0aW9uIGFuZCBiZWxpZWYuCiIiIgpmcm9tIGdhbWVfdWkgaW1wb3J0IEdhbWVVSSwgQ0xJSW50ZXJmYWNlCmltcG9ydCBhc3luY2lvCgppbXBvcnQganNvbgppbXBvcnQgcmUKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIExpc3QsIFNldCwgT3B0aW9uYWwsIFR1cGxlCmZyb20gZGF0YWNsYXNzZXMgaW1wb3J0IGRhdGFjbGFzcywgYXNkaWN0CmZyb20gZW51bSBpbXBvcnQgRW51bQppbXBvcnQgcmFuZG9tCmZyb20gZ2VuZXJhdGVfdG9tX3NjZW5hcmlvcyBpbXBvcnQgZ2VuZXJhdGVfc2NlbmFyaW9zX2Zyb21fdHVwbGVzLCBTcGVjVHVwbGUsIElURU1TX0dFTgpmcm9tIHRvbV9oZWxwZXJzIGltcG9ydCAoCiAgICBTY2VuYXJpbywgRXZlbnQsIEVwaXN0ZW1pY1R5cGUsIEFza0NvbnN0cmFpbnRUeXBlLCBDaGFyYWN0ZXJUeXBlLCBDaGFyYWN0ZXIsIFRlYW0sCiAgICBzYXZlX3NjZW5hcmlvcywgbG9hZF9zY2VuYXJpb3MKKQoKY2xhc3MgQWN0aW9uVHlwZShFbnVtKToKICAgIEFTSyA9ICJhc2siCiAgICBURUxMID0gInRlbGwiCiAgICBQQVNTID0gInBhc3MiCgpAZGF0YWNsYXNzCmNsYXNzIEFjdGlvbjoKICAgICIiIlJlcHJlc2VudHMgYSBwbGF5ZXIgYWN0aW9uLiIiIgogICAgYWN0aW9uX3R5cGU6IEFjdGlvblR5cGUKICAgIHRhcmdldF9jaGFyOiBPcHRpb25hbFtzdHJdID0gTm9uZQogICAgY29udGFpbmVyOiBPcHRpb25hbFtzdHJdID0gTm9uZQogICAgY29udGVudHM6IE9wdGlvbmFsW3N0cl0gPSBOb25lCgpAZGF0YWNsYXNzCmNsYXNzIFR1cm5SZWNvcmQ6CiAgICAiIiJSZWNvcmRzIHdoYXQgaGFwcGVuZWQgaW4gYSB0dXJuLiIiIgogICAgcm91bmRfbnVtOiBpbnQKICAgIGNoYXJhY3Rlcjogc3RyCiAgICBzY2VuYXJpb19kZXNjOiBzdHIKICAgIHF1ZXN0aW9uOiBzdHIKICAgIGFjdGlvbjogc3RyCiAgICBhY3Rpb25fY29zdDogZmxvYXQKICAgIGFuc3dlcl9naXZlbjogc3RyCiAgICBhbnN3ZXJfY29ycmVjdDogYm9vbAogICAgYW5zd2VyX3Njb3JlOiBmbG9hdAogICAgb3B0aW1hbF9hY3Rpb246IHN0cgogICAgd2FzX29wdGltYWw6IGJvb2wKICAgIGJsdWVfc2NvcmVfYWZ0ZXI6IGZsb2F0CiAgICByZWRfc2NvcmVfYWZ0ZXI6IGZsb2F0CiAgICBlcGlzdGVtaWNfdHlwZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUKICAgIGFza19jb25zdHJhaW50OiBPcHRpb25hbFtzdHJdID0gTm9uZQoKY2xhc3MgR2FtZVN0YXRlOgogICAgIiIiTWFuYWdlcyB0aGUgZ2FtZSBzdGF0ZS4iIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNjZW5hcmlvX2ZpbGU6IHN0cik6CiAgICAgICAgc2VsZi5jdXJyZW50X3NjZW5hcmlvX2lkeCA9IDAKICAgICAgICBzZWxmLmN1cnJlbnRfdHVybl9pZHggPSAwCiAgICAgICAgc2VsZi5zY29yZXMgPSB7VGVhbS5CTFVFOiAwLjAsIFRlYW0uUkVEOiAwLjB9CiAgICAgICAgc2VsZi5jaGFyYWN0ZXJzOiBEaWN0W3N0ciwgQ2hhcmFjdGVyXSA9IHt9CiAgICAgICAgc2VsZi50dXJuX3JlY29yZHM6IExpc3RbVHVyblJlY29yZF0gPSBbXQogICAgICAgIHNlbGYuZ2FtZV9vdmVyID0gRmFsc2UKICAgICAgICBzZWxmLndpbm5lciA9IE5vbmUKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLnNjZW5hcmlvcywgY2hhcnMsIGNoYXJ0eXBlcyA9IGxvYWRfc2NlbmFyaW9zKHNjZW5hcmlvX2ZpbGUpCiAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICBwcmludCgiU2NlbmFyaW8gZmlsZSBub3QgZm91bmQuIikKCiAgICAgICAgZm9yIG5hbWUsIGN0eXBlIGluIHppcChjaGFycywgY2hhcnR5cGVzKToKICAgICAgICAgICAgdGVhbSA9IFRlYW0uQkxVRSBpZiBuYW1lIGluIFsnQScsICdCJ10gZWxzZSBUZWFtLlJFRCBpZiBuYW1lIGluIFsnQycsICdEJ10gZWxzZSBUZWFtLk5FVVRSQUwKICAgICAgICAgICAgc2VsZi5jaGFyYWN0ZXJzW25hbWVdID0gQ2hhcmFjdGVyKG5hbWUsIHRlYW0sIGN0eXBlKQoKICAgICAgICBzZWxmLnR1cm5fb3JkZXIgPSBjaGFycwogICAgICAgIHNlbGYuV0lOTklOR19TQ09SRSA9IGludChsZW4oc2VsZi5zY2VuYXJpb3MpL2xlbihzZWxmLnR1cm5fb3JkZXIpKSArIDQKCgogICAgZGVmIGdldF90ZWFtbWF0ZShzZWxmLCBhY3Rvcl9uYW1lOiBzdHIpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAgICAgIiIiR2V0IHRoZSB0ZWFtbWF0ZSBvZiB0aGUgYWN0b3IuIiIiCiAgICAgICAgYWN0b3IgPSBzZWxmLmNoYXJhY3RlcnNbYWN0b3JfbmFtZV0KICAgICAgICBmb3IgbmFtZSwgY2hhciBpbiBzZWxmLmNoYXJhY3RlcnMuaXRlbXMoKToKICAgICAgICAgICAgaWYgbmFtZSAhPSBhY3Rvcl9uYW1lIGFuZCBjaGFyLnRlYW0gPT0gYWN0b3IudGVhbToKICAgICAgICAgICAgICAgIHJldHVybiBuYW1lCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGlzX2hvbmVzdF90byhzZWxmLCBzcGVha2VyX25hbWU6IHN0ciwgbGlzdGVuZXJfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgICIiIkNoZWNrIGlmIHNwZWFrZXIgaXMgaG9uZXN0IHRvIGxpc3RlbmVyLiIiIgogICAgICAgIHNwZWFrZXIgPSBzZWxmLmNoYXJhY3RlcnNbc3BlYWtlcl9uYW1lXQogICAgICAgIGxpc3RlbmVyID0gc2VsZi5jaGFyYWN0ZXJzW2xpc3RlbmVyX25hbWVdCiAgICAgICAgCiAgICAgICAgaWYgc3BlYWtlci5jaGFyX3R5cGUgaW4gW0NoYXJhY3RlclR5cGUuTkVVVFJBTCwgQ2hhcmFjdGVyVHlwZS5IT05FU1RfT1BQT05FTlQsIENoYXJhY3RlclR5cGUuSE9ORVNUX1RFQU1NQVRFXToKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gc3BlYWtlci50ZWFtID09IGxpc3RlbmVyLnRlYW0KICAgIAogICAgZGVmIHRydXN0cyhzZWxmLCBsaXN0ZW5lcl9uYW1lOiBzdHIsIHNwZWFrZXJfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgIGxpc3RlbmVyID0gc2VsZi5jaGFyYWN0ZXJzW2xpc3RlbmVyX25hbWVdCiAgICAgICAgc3BlYWtlciA9IHNlbGYuY2hhcmFjdGVyc1tzcGVha2VyX25hbWVdCgogICAgICAgIGlmIGxpc3RlbmVyLmNoYXJfdHlwZSBpbiBbQ2hhcmFjdGVyVHlwZS5ORVVUUkFMLCBDaGFyYWN0ZXJUeXBlLkhPTkVTVF9PUFBPTkVOVCwgQ2hhcmFjdGVyVHlwZS5IT05FU1RfVEVBTU1BVEVdOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBzcGVha2VyLnRlYW0gPT0gbGlzdGVuZXIudGVhbQogICAgICAgIAogICAgZGVmIHJlc2V0X3NjZW5hcmlvX2tub3dsZWRnZShzZWxmKToKICAgICAgICAiIiJSZXNldCBhbGwgY2hhcmFjdGVyIGtub3dsZWRnZSBmb3IgbmV3IHNjZW5hcmlvLiIiIgogICAgICAgIGZvciBjaGFyIGluIHNlbGYuY2hhcmFjdGVycy52YWx1ZXMoKToKICAgICAgICAgICAgY2hhci5rbm93bGVkZ2UgPSB7fQogICAgICAgICAgICBjaGFyLmJlbGllZnMgPSB7fQogICAgCiAgICBkZWYgZ2V0X3ByZXNlbnRfYXRfZW5kKHNlbGYsIHNjZW5hcmlvOiBTY2VuYXJpbykgLT4gU2V0W3N0cl06CiAgICAgICAgIiIiR2V0IHdobydzIHByZXNlbnQgYXQgdGhlIGVuZCBvZiB0aGUgc2NlbmFyaW8uIiIiCiAgICAgICAgcHJlc2VudCA9IHNldChzY2VuYXJpby5wcmVzZW50X2luaXRpYWxseSkKICAgICAgICBmb3IgZXZlbnQgaW4gc2NlbmFyaW8uZXZlbnRzOgogICAgICAgICAgICBpZiBldmVudC5ldmVudF90eXBlID09ICdsZWF2ZSc6CiAgICAgICAgICAgICAgICBwcmVzZW50LmRpc2NhcmQoZXZlbnQuY2hhcmFjdGVyKQogICAgICAgIHJldHVybiBwcmVzZW50CiAgICAKICAgIGRlZiBwcm9jZXNzX3NjZW5hcmlvX2V2ZW50cyhzZWxmLCBzY2VuYXJpbzogU2NlbmFyaW8pOgogICAgICAgICIiIlByb2Nlc3Mgc2NlbmFyaW8gZXZlbnRzIHRvIGRldGVybWluZSB3aGF0IGVhY2ggY2hhcmFjdGVyIGtub3dzLiIiIgogICAgICAgIHNlbGYucmVzZXRfc2NlbmFyaW9fa25vd2xlZGdlKCkKICAgICAgICAKICAgICAgICBwcmVzZW50ID0gc2V0KHNjZW5hcmlvLnByZXNlbnRfaW5pdGlhbGx5KQogICAgICAgIGNvbnRhaW5lcl9jb250ZW50cyA9IHsnYmFnJzogTm9uZSwgJ2JveCc6IE5vbmV9CiAgICAgICAgCiAgICAgICAgZm9yIGV2ZW50IGluIHNjZW5hcmlvLmV2ZW50czoKICAgICAgICAgICAgaWYgZXZlbnQuZXZlbnRfdHlwZSA9PSAncHV0JzoKICAgICAgICAgICAgICAgIGNvbnRhaW5lcl9jb250ZW50c1tldmVudC5jb250YWluZXJdID0gZXZlbnQuaXRlbQogICAgICAgICAgICAgICAgZm9yIGNoYXJfbmFtZSBpbiBwcmVzZW50OgogICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhcmFjdGVyc1tjaGFyX25hbWVdLnVwZGF0ZV9rbm93bGVkZ2UoZXZlbnQuY29udGFpbmVyLCBldmVudC5pdGVtKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIGV2ZW50LmV2ZW50X3R5cGUgPT0gJ21vdmUnOgogICAgICAgICAgICAgICAgY29udGFpbmVyX2NvbnRlbnRzW2V2ZW50LnRvX2NvbnRhaW5lcl0gPSBldmVudC5pdGVtCiAgICAgICAgICAgICAgICBjb250YWluZXJfY29udGVudHNbZXZlbnQuZnJvbV9jb250YWluZXJdID0gTm9uZQogICAgICAgICAgICAgICAgZm9yIGNoYXJfbmFtZSBpbiBwcmVzZW50OgogICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhcmFjdGVyc1tjaGFyX25hbWVdLnVwZGF0ZV9rbm93bGVkZ2UoZXZlbnQudG9fY29udGFpbmVyLCBldmVudC5pdGVtKQogICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhcmFjdGVyc1tjaGFyX25hbWVdLnVwZGF0ZV9rbm93bGVkZ2UoZXZlbnQuZnJvbV9jb250YWluZXIsIE5vbmUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIGV2ZW50LmV2ZW50X3R5cGUgPT0gJ2xlYXZlJzoKICAgICAgICAgICAgICAgIHByZXNlbnQuZGlzY2FyZChldmVudC5jaGFyYWN0ZXIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcl9jb250ZW50cwogICAgCiAgICBkZWYgZXhlY3V0ZV9ucGNfYWN0aW9uKHNlbGYsIGFjdG9yX25hbWU6IHN0ciwgc2NlbmFyaW86IFNjZW5hcmlvLCB0cnVlX2NvbnRlbnRzOiBEaWN0W3N0ciwgc3RyXSkgLT4gQWN0aW9uOgogICAgICAgICIiIkV4ZWN1dGUgTlBDIGFjdGlvbiBiYXNlZCBvbiBnYW1lIHJ1bGVzIC0gY29tcGxldGVseSBkZXRlcm1pbmVkLiIiIgogICAgICAgIGNvbnRhaW5lciA9IHNjZW5hcmlvLnF1ZXN0aW9uX2NvbnRhaW5lcgogICAgICAgIHRydXRoID0gdHJ1ZV9jb250ZW50c1tjb250YWluZXJdCiAgICAgICAgdGFyZ2V0ID0gc2NlbmFyaW8ud2hvX2Fuc3dlcnMKICAgICAgICAKICAgICAgICAjIFRlYW1tYXRlIGFuc3dlcmluZyBzY2VuYXJpb3MKICAgICAgICBpZiBzY2VuYXJpby5lcGlzdGVtaWNfdHlwZSBpbiBbRXBpc3RlbWljVHlwZS5URUFNTUFURV9IQVNfRkFMU0VfQkVMSUVGLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVwaXN0ZW1pY1R5cGUuVEVBTU1BVEVfSEFTX05PX0JFTElFRl06CiAgICAgICAgICAgIHJldHVybiBBY3Rpb24oQWN0aW9uVHlwZS5URUxMLCB0YXJnZXQsIGNvbnRhaW5lciwgdHJ1dGgpCgogICAgICAgIGlmIHNjZW5hcmlvLmVwaXN0ZW1pY190eXBlIGluIFtFcGlzdGVtaWNUeXBlLlRFQU1NQVRFX0hBU19UUlVFX0JFTElFRiwgRXBpc3RlbWljVHlwZS5URUFNTUFURV9IQVNfVU5LTk9XTl9CRUxJRUZdOgogICAgICAgICAgICByZXR1cm4gQWN0aW9uKEFjdGlvblR5cGUuUEFTUykKCiAgICAgICAgIyBPcHBvbmVudCBhbnN3ZXJpbmcgc2NlbmFyaW9zCiAgICAgICAgaWYgc2NlbmFyaW8uZXBpc3RlbWljX3R5cGUgaW4gW0VwaXN0ZW1pY1R5cGUuT1BQT05FTlRfSEFTX0ZBTFNFX0JFTElFRiwgRXBpc3RlbWljVHlwZS5PUFBPTkVOVF9IQVNfVFJVRV9CRUxJRUZfV0lUSF9DRVJUQUlOVFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXBpc3RlbWljVHlwZS5ESVNIT05FU1RfT1BQT05FTlRfSEFTX1RSVUVfQkVMSUVGX1dJVEhfVU5DRVJUQUlOVFldOgogICAgICAgICAgICByZXR1cm4gQWN0aW9uKEFjdGlvblR5cGUuUEFTUykKICAgICAgICAKICAgICAgICBpZiBzY2VuYXJpby5lcGlzdGVtaWNfdHlwZSA9PSBFcGlzdGVtaWNUeXBlLkhPTkVTVF9PUFBPTkVOVF9IQVNfVFJVRV9CRUxJRUZfV0lUSF9VTkNFUlRBSU5UWToKICAgICAgICAgICAgaWYgc2VsZi5jaGFyYWN0ZXJzW2FjdG9yX25hbWVdLmNoYXJfdHlwZSBpbiBbQ2hhcmFjdGVyVHlwZS5IT05FU1RfT1BQT05FTlQsIENoYXJhY3RlclR5cGUuSE9ORVNUX1RFQU1NQVRFXToKICAgICAgICAgICAgICAgIHJldHVybiBBY3Rpb24oQWN0aW9uVHlwZS5QQVNTKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbGllID0gbmV4dCgoaXRlbSBmb3IgaXRlbSBpbiBJVEVNU19HRU4gaWYgaXRlbSAhPSB0cnV0aCksICdub3RoaW5nJykKICAgICAgICAgICAgICAgIHJldHVybiBBY3Rpb24oQWN0aW9uVHlwZS5URUxMLCB0YXJnZXQsIGNvbnRhaW5lciwgbGllKQogICAgICAgIAogICAgICAgICMgUGxheWVyIGFuc3dlcmluZyBzY2VuYXJpb3MKICAgICAgICBpZiBzY2VuYXJpby5lcGlzdGVtaWNfdHlwZSBpbiBbRXBpc3RlbWljVHlwZS5QTEFZRVJfSEFTX1VOQ0VSVEFJTlRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVwaXN0ZW1pY1R5cGUuUExBWUVSX0hBU19OT19CRUxJRUZdOgogICAgICAgICAgICBwcmVzZW50ID0gc2VsZi5nZXRfcHJlc2VudF9hdF9lbmQoc2NlbmFyaW8pCiAgICAgICAgICAgIHByZXNlbnQuZGlzY2FyZChhY3Rvcl9uYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBQcmVmZXJlbmNlOiB0ZWFtbWF0ZSAtPiBuZXV0cmFsIC0+IG9wcG9uZW50IChpZiB0cnVzdHMgb3Bwb25lbnRzKQogICAgICAgICAgICB0ZWFtbWF0ZSA9IHNlbGYuZ2V0X3RlYW1tYXRlKGFjdG9yX25hbWUpCiAgICAgICAgICAgIGlmIHRlYW1tYXRlIGFuZCB0ZWFtbWF0ZSBpbiBwcmVzZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIEFjdGlvbihBY3Rpb25UeXBlLkFTSywgdGVhbW1hdGUsIGNvbnRhaW5lcikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICdOJyBpbiBwcmVzZW50OgogICAgICAgICAgICAgICAgcmV0dXJuIEFjdGlvbihBY3Rpb25UeXBlLkFTSywgJ04nLCBjb250YWluZXIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEFzayBvcHBvbmVudCBvbmx5IGlmIGFjdG9yIHRydXN0cyBvcHBvbmVudHMKICAgICAgICAgICAgYWN0b3IgPSBzZWxmLmNoYXJhY3RlcnNbYWN0b3JfbmFtZV0KICAgICAgICAgICAgYWN0b3JfdHJ1c3RzX29wcG9uZW50cyA9IGFjdG9yLmNoYXJfdHlwZSBpbiBbQ2hhcmFjdGVyVHlwZS5IT05FU1RfVEVBTU1BVEUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGFyYWN0ZXJUeXBlLkhPTkVTVF9PUFBPTkVOVF0KICAgICAgICAgICAgaWYgYWN0b3JfdHJ1c3RzX29wcG9uZW50czoKICAgICAgICAgICAgICAgICMgQ2hvb3NlIGEgcmFuZG9tIGVsaWdpYmxlIG9wcG9uZW50IGZyb20gdGhvc2UgcHJlc2VudAogICAgICAgICAgICAgICAgZWxpZ2libGUgPSBbbmFtZSBmb3IgbmFtZSBpbiBwcmVzZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lICE9IGFjdG9yX25hbWUgYW5kIHNlbGYuY2hhcmFjdGVyc1tuYW1lXS5jaGFyX3R5cGUgaW4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlclR5cGUuSE9ORVNUX1RFQU1NQVRFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlclR5cGUuRElTSE9ORVNUX1RFQU1NQVRFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlclR5cGUuSE9ORVNUX09QUE9ORU5ULAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlclR5cGUuRElTSE9ORVNUX09QUE9ORU5UCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXQogICAgICAgICAgICAgICAgaWYgZWxpZ2libGU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFjdGlvbihBY3Rpb25UeXBlLkFTSywgcmFuZG9tLmNob2ljZShlbGlnaWJsZSksIGNvbnRhaW5lcikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBBY3Rpb24oQWN0aW9uVHlwZS5QQVNTKQogICAgICAgIAogICAgICAgIHJldHVybiBBY3Rpb24oQWN0aW9uVHlwZS5QQVNTKQogICAgCiAgICBkZWYgaXNfYWN0aW9uX29wdGltYWwoc2VsZiwgYWN0aW9uX3N0cjogc3RyLCBzY2VuYXJpbzogU2NlbmFyaW8sIHRydWVfY29udGVudHM6IERpY3Rbc3RyLCBzdHJdKSAtPiBib29sOgogICAgICAgICIiIkNoZWNrIGlmIGxpdmUgcGxheWVyJ3MgYWN0aW9uIGlzIG9wdGltYWwuIiIiCiAgICAgICAgYWN0aW9uID0gc2VsZi5wYXJzZV9hY3Rpb24oYWN0aW9uX3N0cikKICAgICAgICBpZiBub3QgYWN0aW9uOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAKICAgICAgICAjIEZvciBUZWxsIHRlYW1tYXRlIHRydXRoIHNjZW5hcmlvcwogICAgICAgIGlmIHNjZW5hcmlvLmVwaXN0ZW1pY190eXBlIGluIFtFcGlzdGVtaWNUeXBlLlRFQU1NQVRFX0hBU19GQUxTRV9CRUxJRUYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXBpc3RlbWljVHlwZS5URUFNTUFURV9IQVNfTk9fQkVMSUVGXToKICAgICAgICAgICAgdHJ1dGggPSB0cnVlX2NvbnRlbnRzW3NjZW5hcmlvLnF1ZXN0aW9uX2NvbnRhaW5lcl0KICAgICAgICAgICAgcmV0dXJuIChhY3Rpb24uYWN0aW9uX3R5cGUgPT0gQWN0aW9uVHlwZS5URUxMIGFuZAogICAgICAgICAgICAgICAgICAgYWN0aW9uLnRhcmdldF9jaGFyID09IHNjZW5hcmlvLndob19hbnN3ZXJzIGFuZAogICAgICAgICAgICAgICAgICAgYWN0aW9uLmNvbnRhaW5lciA9PSBzY2VuYXJpby5xdWVzdGlvbl9jb250YWluZXIgYW5kCiAgICAgICAgICAgICAgICAgICBhY3Rpb24uY29udGVudHMgPT0gdHJ1dGgpCiAgICAgICAgCiAgICAgICAgIyBGb3IgVGVsbCBvcHBvbmVudCB3aXRoIHVuY2VydGFpbnR5CiAgICAgICAgaWYgc2NlbmFyaW8uZXBpc3RlbWljX3R5cGUgPT0gRXBpc3RlbWljVHlwZS5IT05FU1RfT1BQT05FTlRfSEFTX1RSVUVfQkVMSUVGX1dJVEhfVU5DRVJUQUlOVFk6CiAgICAgICAgICAgIHRydXRoID0gdHJ1ZV9jb250ZW50c1tzY2VuYXJpby5xdWVzdGlvbl9jb250YWluZXJdCiAgICAgICAgICAgIGlmIGFjdGlvbi5hY3Rpb25fdHlwZSAhPSBBY3Rpb25UeXBlLlRFTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgaWYgYWN0aW9uLnRhcmdldF9jaGFyICE9IHNjZW5hcmlvLndob19hbnN3ZXJzIG9yIGFjdGlvbi5jb250YWluZXIgIT0gc2NlbmFyaW8ucXVlc3Rpb25fY29udGFpbmVyOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIHJldHVybiBhY3Rpb24uY29udGVudHMgIT0gdHJ1dGgKICAgICAgICAKICAgICAgICAjIEZvciBBc2sgc2NlbmFyaW9zCiAgICAgICAgaWYgc2NlbmFyaW8uZXBpc3RlbWljX3R5cGUgaW4gW0VwaXN0ZW1pY1R5cGUuUExBWUVSX0hBU19VTkNFUlRBSU5UWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFcGlzdGVtaWNUeXBlLlBMQVlFUl9IQVNfTk9fQkVMSUVGXToKICAgICAgICAgICAgaWYgc2NlbmFyaW8uYXNrX2NvbnN0cmFpbnQgPT0gQXNrQ29uc3RyYWludFR5cGUuVEVBTU1BVEVfTkVVVFJBTF9BTkRfSE9ORVNUX09QUE9ORU5UX0xBQ0tfS05PV0xFREdFOgogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbi5hY3Rpb25fdHlwZSA9PSBBY3Rpb25UeXBlLlBBU1MKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFjdGlvbi5hY3Rpb25fdHlwZSA9PSBBY3Rpb25UeXBlLlRFTEwgb3IgYWN0aW9uLmNvbnRhaW5lciAhPSBzY2VuYXJpby5xdWVzdGlvbl9jb250YWluZXI6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHByZXNlbnQgPSBzZWxmLmdldF9wcmVzZW50X2F0X2VuZChzY2VuYXJpbykKICAgICAgICAgICAgcHJlc2VudC5kaXNjYXJkKHNjZW5hcmlvLndob3NlX3R1cm4pCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBhY3Rpb24udGFyZ2V0X2NoYXIgbm90IGluIHByZXNlbnQ6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNjZW5hcmlvLmFza19jb25zdHJhaW50ID09IEFza0NvbnN0cmFpbnRUeXBlLk5PX0NPTlNUUkFJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jaGFyYWN0ZXJzW2FjdGlvbi50YXJnZXRfY2hhcl0uY2hhcl90eXBlIGluIFtDaGFyYWN0ZXJUeXBlLkhPTkVTVF9URUFNTUFURSwgQ2hhcmFjdGVyVHlwZS5ESVNIT05FU1RfVEVBTU1BVEUsIENoYXJhY3RlclR5cGUuTkVVVFJBTF0KICAgICAgICAgICAgZWxpZiBzY2VuYXJpby5hc2tfY29uc3RyYWludCA9PSBBc2tDb25zdHJhaW50VHlwZS5URUFNTUFURV9MQUNLU19LTk9XTEVER0U6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jaGFyYWN0ZXJzW2FjdGlvbi50YXJnZXRfY2hhcl0uY2hhcl90eXBlIGluIFtDaGFyYWN0ZXJUeXBlLk5FVVRSQUwsIENoYXJhY3RlclR5cGUuSE9ORVNUX09QUE9ORU5UXQogICAgICAgICAgICBlbGlmIHNjZW5hcmlvLmFza19jb25zdHJhaW50ID09IEFza0NvbnN0cmFpbnRUeXBlLlRFQU1NQVRFX0FORF9ORVVUUkFMX0xBQ0tfS05PV0xFREdFOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY2hhcmFjdGVyc1thY3Rpb24udGFyZ2V0X2NoYXJdLmNoYXJfdHlwZSBpbiBbQ2hhcmFjdGVyVHlwZS5IT05FU1RfT1BQT05FTlRdCiAgICAgICAgICAgIGVsc2U6IAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgIyBGb3IgUGFzcyBzY2VuYXJpb3MKICAgICAgICBpZiBzY2VuYXJpby5lcGlzdGVtaWNfdHlwZSBpbiBbRXBpc3RlbWljVHlwZS5URUFNTUFURV9IQVNfVFJVRV9CRUxJRUYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXBpc3RlbWljVHlwZS5URUFNTUFURV9IQVNfVU5LTk9XTl9CRUxJRUYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXBpc3RlbWljVHlwZS5PUFBPTkVOVF9IQVNfRkFMU0VfQkVMSUVGLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVwaXN0ZW1pY1R5cGUuT1BQT05FTlRfSEFTX1RSVUVfQkVMSUVGX1dJVEhfQ0VSVEFJTlRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVwaXN0ZW1pY1R5cGUuRElTSE9ORVNUX09QUE9ORU5UX0hBU19UUlVFX0JFTElFRl9XSVRIX1VOQ0VSVEFJTlRZXToKICAgICAgICAgICAgcmV0dXJuIGFjdGlvbi5hY3Rpb25fdHlwZSA9PSBBY3Rpb25UeXBlLlBBU1MKICAgICAgICAKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGdldF9jdXJyZW50X3NjZW5hcmlvKHNlbGYpIC0+IE9wdGlvbmFsW1NjZW5hcmlvXToKICAgICAgICAiIiJHZXQgdGhlIGN1cnJlbnQgc2NlbmFyaW8uIiIiCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3NjZW5hcmlvX2lkeCA+PSBsZW4oc2VsZi5zY2VuYXJpb3MpOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHJldHVybiBzZWxmLnNjZW5hcmlvc1tzZWxmLmN1cnJlbnRfc2NlbmFyaW9faWR4XQogICAgCiAgICBkZWYgZ2V0X2N1cnJlbnRfdHVybl9jaGFyYWN0ZXIoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICAiIiJHZXQgd2hvc2UgdHVybiBpdCBpcy4iIiIKICAgICAgICBpZiBzZWxmLmN1cnJlbnRfdHVybl9pZHggPj0gbGVuKHNlbGYudHVybl9vcmRlcik6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgcmV0dXJuIHNlbGYudHVybl9vcmRlcltzZWxmLmN1cnJlbnRfdHVybl9pZHhdCiAgICAKICAgIGRlZiBwYXJzZV9hY3Rpb24oc2VsZiwgYWN0aW9uX3N0cjogc3RyKSAtPiBPcHRpb25hbFtBY3Rpb25dOgogICAgICAgICIiIlBhcnNlIGFjdGlvbiBzdHJpbmcgaW50byBBY3Rpb24gb2JqZWN0LiIiIgogICAgICAgIGFjdGlvbl9zdHIgPSBhY3Rpb25fc3RyLnN0cmlwKCkKICAgICAgICAKICAgICAgICBpZiBhY3Rpb25fc3RyLmxvd2VyKCkgPT0gJ3Bhc3MnOgogICAgICAgICAgICByZXR1cm4gQWN0aW9uKEFjdGlvblR5cGUuUEFTUykKICAgICAgICAKICAgICAgICBhc2tfbWF0Y2ggPSByZS5tYXRjaChyJ0Fza1woKFtBLUROXSksXHMqKGJhZ3xib3gpXCknLCBhY3Rpb25fc3RyLCByZS5JR05PUkVDQVNFKQogICAgICAgIGlmIGFza19tYXRjaDoKICAgICAgICAgICAgcmV0dXJuIEFjdGlvbihBY3Rpb25UeXBlLkFTSywgYXNrX21hdGNoLmdyb3VwKDEpLnVwcGVyKCksIGFza19tYXRjaC5ncm91cCgyKS5sb3dlcigpKQogICAgICAgIAogICAgICAgIHRlbGxfbWF0Y2ggPSByZS5tYXRjaChyJ1RlbGxcKChbQS1ETl0pLFxzKihiYWd8Ym94KSxccyooXHcrKVwpJywgYWN0aW9uX3N0ciwgcmUuSUdOT1JFQ0FTRSkKICAgICAgICBpZiB0ZWxsX21hdGNoOgogICAgICAgICAgICByZXR1cm4gQWN0aW9uKEFjdGlvblR5cGUuVEVMTCwgdGVsbF9tYXRjaC5ncm91cCgxKS51cHBlcigpLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHRlbGxfbWF0Y2guZ3JvdXAoMikubG93ZXIoKSwgdGVsbF9tYXRjaC5ncm91cCgzKS5sb3dlcigpKQogICAgICAgIAogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBleGVjdXRlX2FjdGlvbihzZWxmLCBhY3Rvcl9uYW1lOiBzdHIsIGFjdGlvbjogQWN0aW9uLCB0cnVlX2NvbnRlbnRzOiBEaWN0W3N0ciwgc3RyXSkgLT4gVHVwbGVbZmxvYXQsIHN0cl06CiAgICAgICAgIiIiRXhlY3V0ZSBhbiBhY3Rpb24gYW5kIHJldHVybiB0aGUgc2NvcmUgY2hhbmdlIGFuZCBkZXNjcmlwdGlvbi4iIiIKICAgICAgICBzY29yZV9kZWx0YSA9IDAuMAogICAgICAgIGRlc2MgPSAiIgogICAgICAgIAogICAgICAgIGlmIGFjdGlvbi5hY3Rpb25fdHlwZSA9PSBBY3Rpb25UeXBlLlBBU1M6CiAgICAgICAgICAgIGRlc2MgPSAiUGFzcyIKICAgICAgICAgICAgCiAgICAgICAgZWxpZiBhY3Rpb24uYWN0aW9uX3R5cGUgPT0gQWN0aW9uVHlwZS5BU0s6CiAgICAgICAgICAgIHNjb3JlX2RlbHRhIC09IDAuNQogICAgICAgICAgICB0YXJnZXQgPSBzZWxmLmNoYXJhY3RlcnNbYWN0aW9uLnRhcmdldF9jaGFyXQogICAgICAgICAgICBjb250YWluZXIgPSBhY3Rpb24uY29udGFpbmVyCgogICAgICAgICAgICAjIFdoYXQgdGhlIHRhcmdldCBzYXlzOgogICAgICAgICAgICAjIC0gSG9uZXN0OiByZXBvcnQgd2hhdCB0aGV5IGJlbGlldmUgKHdoYXQgdGhleSBvYnNlcnZlZCkuCiAgICAgICAgICAgICMgLSBEaXNob25lc3Q6IGludGVudGlvbmFsbHkgc2F5IHNvbWV0aGluZyBkaWZmZXJlbnQgZnJvbSB0aGVpciBiZWxpZWYuCiAgICAgICAgICAgIGlmIHRhcmdldC5jaGFyX3R5cGUgaW4gW0NoYXJhY3RlclR5cGUuRElTSE9ORVNUX1RFQU1NQVRFLCBDaGFyYWN0ZXJUeXBlLkRJU0hPTkVTVF9PUFBPTkVOVF0gYW5kIHRhcmdldC50ZWFtICE9IHNlbGYuY2hhcmFjdGVyc1thY3Rvcl9uYW1lXS50ZWFtOgogICAgICAgICAgICAgICAgYmVsaWV2ZWQgPSB0YXJnZXQuZ2V0X2JlbGllZihjb250YWluZXIpCiAgICAgICAgICAgICAgICBvcHRpb25zID0gWydhcHBsZScsICdiYWxsJywgJ2JhbmFuYScsICdicmljaycsICdzdGFwbGVyJywgJ29yYW5nZSddCiAgICAgICAgICAgICAgICAjIFBpY2sgYW4gaXRlbSBkaWZmZXJlbnQgZnJvbSB3aGF0IHRoZXkgYmVsaWV2ZTsgaWYgdGhleSBiZWxpZXZlIG5vdGhpbmcsIHBpY2sgYW55IGl0ZW0uCiAgICAgICAgICAgICAgICB3cm9uZyA9IG5leHQoKHggZm9yIHggaW4gb3B0aW9ucyBpZiB4ICE9IChiZWxpZXZlZCBvciAnbm90aGluZycpKSwgb3B0aW9uc1swXSkKICAgICAgICAgICAgICAgIGFuc3dlciA9IHdyb25nCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhbnN3ZXIgPSB0YXJnZXQuZ2V0X2JlbGllZihjb250YWluZXIpCgogICAgICAgICAgICAjIEFza2luZyBhbHdheXMgdXBkYXRlcyB0aGUgYXNrZXLigJlzIGJlbGllZiB3aXRoIHdoYXRldmVyIHdhcyBhbnN3ZXJlZC4KICAgICAgICAgICAgc2VsZi5jaGFyYWN0ZXJzW2FjdG9yX25hbWVdLnJlY2VpdmVfaW5mbyhjb250YWluZXIsIGFuc3dlciwgdGFyZ2V0LCBUcnVlKQoKICAgICAgICAgICAgZGVzYyA9IGYiQXNrKHthY3Rpb24udGFyZ2V0X2NoYXJ9LCB7Y29udGFpbmVyfSkiCiAgICAgICAgICAgIAogICAgICAgIGVsaWYgYWN0aW9uLmFjdGlvbl90eXBlID09IEFjdGlvblR5cGUuVEVMTDoKICAgICAgICAgICAgc2NvcmVfZGVsdGEgLT0gMC41CiAgICAgICAgICAgIHRhcmdldF9uYW1lID0gYWN0aW9uLnRhcmdldF9jaGFyCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzZWxmLnRydXN0cyh0YXJnZXRfbmFtZSwgYWN0b3JfbmFtZSk6CiAgICAgICAgICAgICAgICBzZWxmLmNoYXJhY3RlcnNbdGFyZ2V0X25hbWVdLnJlY2VpdmVfaW5mbyhhY3Rpb24uY29udGFpbmVyLCBhY3Rpb24uY29udGVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhcmFjdGVyc1thY3Rvcl9uYW1lXSwgVHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGRlc2MgPSBmIlRlbGwoe2FjdGlvbi50YXJnZXRfY2hhcn0sIHthY3Rpb24uY29udGFpbmVyfSwge2FjdGlvbi5jb250ZW50c30pIgogICAgICAgIAogICAgICAgIHJldHVybiBzY29yZV9kZWx0YSwgZGVzYwogICAgCiAgICBkZWYgcmVzb2x2ZV9hbnN3ZXJfcGhhc2Uoc2VsZiwgc2NlbmFyaW86IFNjZW5hcmlvLCB0cnVlX2NvbnRlbnRzOiBEaWN0W3N0ciwgc3RyXSkgLT4gVHVwbGVbc3RyLCBib29sLCBmbG9hdF06CiAgICAgICAgIiIiUmVzb2x2ZSB0aGUgYW5zd2VyIHBoYXNlIGFuZCByZXR1cm4gYW5zd2VyLCBjb3JyZWN0bmVzcywgYW5kIHNjb3JlIGNoYW5nZS4iIiIKICAgICAgICBhbnN3ZXJlciA9IHNlbGYuY2hhcmFjdGVyc1tzY2VuYXJpby53aG9fYW5zd2Vyc10KICAgICAgICBjb250YWluZXIgPSBzY2VuYXJpby5xdWVzdGlvbl9jb250YWluZXIKICAgICAgICAKICAgICAgICBiZWxpZWYgPSBhbnN3ZXJlci5nZXRfYmVsaWVmKGNvbnRhaW5lcikKICAgICAgICB0cnV0aCA9IHRydWVfY29udGVudHNbY29udGFpbmVyXQogICAgICAgIAogICAgICAgIGlzX2NvcnJlY3QgPSAoYmVsaWVmID09IHRydXRoKQogICAgICAgIAogICAgICAgIGlmIGlzX2NvcnJlY3Q6CiAgICAgICAgICAgIHJldHVybiBiZWxpZWYgaWYgYmVsaWVmIGVsc2UgJ25vdGhpbmcnLCBUcnVlLCAxLjAKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gYmVsaWVmIGlmIGJlbGllZiBlbHNlICdub3RoaW5nJywgRmFsc2UsIDAuMAogICAgCiAgICBkZWYgY2hlY2tfZ2FtZV9vdmVyKHNlbGYpOgogICAgICAgICIiIkNoZWNrIGlmIGdhbWUgaXMgb3Zlci4iIiIKICAgICAgICBpZiBzZWxmLnNjb3Jlc1tUZWFtLkJMVUVdID49IHNlbGYuV0lOTklOR19TQ09SRToKICAgICAgICAgICAgc2VsZi5nYW1lX292ZXIgPSBUcnVlCiAgICAgICAgICAgIHNlbGYud2lubmVyID0gVGVhbS5CTFVFCiAgICAgICAgZWxpZiBzZWxmLnNjb3Jlc1tUZWFtLlJFRF0gPj0gc2VsZi5XSU5OSU5HX1NDT1JFOgogICAgICAgICAgICBzZWxmLmdhbWVfb3ZlciA9IFRydWUKICAgICAgICAgICAgc2VsZi53aW5uZXIgPSBUZWFtLlJFRAogICAgICAgIGVsaWYgc2VsZi5jdXJyZW50X3NjZW5hcmlvX2lkeCA+PSBsZW4oc2VsZi5zY2VuYXJpb3MpOgogICAgICAgICAgICBzZWxmLmdhbWVfb3ZlciA9IFRydWUKICAgICAgICAgICAgaWYgc2VsZi5zY29yZXNbVGVhbS5CTFVFXSA+IHNlbGYuc2NvcmVzW1RlYW0uUkVEXToKICAgICAgICAgICAgICAgIHNlbGYud2lubmVyID0gVGVhbS5CTFVFCiAgICAgICAgICAgIGVsaWYgc2VsZi5zY29yZXNbVGVhbS5SRURdID4gc2VsZi5zY29yZXNbVGVhbS5CTFVFXToKICAgICAgICAgICAgICAgIHNlbGYud2lubmVyID0gVGVhbS5SRUQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYud2lubmVyID0gTm9uZQogICAgCiAgICBkZWYgYWR2YW5jZV90dXJuKHNlbGYpOgogICAgICAgICIiIk1vdmUgdG8gbmV4dCB0dXJuLiIiIgogICAgICAgIHNlbGYuY3VycmVudF9zY2VuYXJpb19pZHggKz0gMQogICAgICAgIHNlbGYuY3VycmVudF90dXJuX2lkeCArPSAxCiAgICAgICAgaWYgc2VsZi5jdXJyZW50X3R1cm5faWR4ID49IGxlbihzZWxmLnR1cm5fb3JkZXIpOgogICAgICAgICAgICBzZWxmLmN1cnJlbnRfdHVybl9pZHggPSAwCgoKZGVmIHNhdmVfZ2FtZV9yZXN1bHRzKHR1cm5fcmVjb3JkczogTGlzdFtUdXJuUmVjb3JkXSwgZmlsZW5hbWU6IHN0cik6CiAgICAiIiJTYXZlIGdhbWUgcmVzdWx0cyB0byBKU09OIGZpbGUuIiIiCiAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICd3JykgYXMgZjoKICAgICAgICBqc29uLmR1bXAoW2FzZGljdChyKSBmb3IgciBpbiB0dXJuX3JlY29yZHNdLCBmLCBpbmRlbnQ9MikKCmFzeW5jIGRlZiBwbGF5X2dhbWVfY2xpKHNjZW5hcmlvX2ZpbGU6IHN0ciA9IE5vbmUsIGh1bWFuX3BsYXllcjogYm9vbCA9IFRydWUsIHVpOiBHYW1lVUkgPSBOb25lKToKICAgICIiIlBsYXkgdGhlIGdhbWUgdXNpbmcgdGhlIHByb3ZpZGVkIFVJIGludGVyZmFjZS4iIiIKICAgIAogICAgaWYgdWkgaXMgTm9uZToKICAgICAgICB1aSA9IENMSUludGVyZmFjZSgpCiAgICAKICAgIGdhbWUgPSBHYW1lU3RhdGUoc2NlbmFyaW9fZmlsZT1zY2VuYXJpb19maWxlKQoKICAgIEdBTUVfU0VUVVAgPSAiIiIKICAgIExldCdzIHBsYXkgYSBnYW1lISBJJ20gZ29pbmcgdG8gcmVhZCBhIHNlcmllcyBvZiBzY2VuYXJpb3MsIGFuZCBwbGF5ZXJzIHdpbGwgbmVlZCB0byBmaWd1cmUgb3V0IHRoZSByaWdodCBhY3Rpb24gdG8gdGFrZSBpbiBlYWNoIG9uZSwgc28gdGhhdCB0aGVpciB0ZWFtIHNjb3JlcyBtb3JlIHBvaW50cyB0aGFuIHRoZWlyIG9wcG9uZW50J3MgdGVhbS4gQWxsIHRoZSBzY2VuYXJpb3MgaW52b2x2ZSBwZW9wbGUgZ29pbmcgaW4gYW5kIG91dCBvZiByb29tcy4gQXNzdW1lIHRoYXQgaWYgYSBwZXJzb24gaXMgaW5zaWRlIGEgcm9vbSB0aGV5IGFyZSBhd2FyZSBvZiB3aGVyZSBldmVyeXRoaW5nIGluIHRoZSByb29tIGlzLiBBc3N1bWUgdGhhdCB3aGVuIHRoZXkgYXJlIG91dHNpZGUgdGhlIHJvb20gdGhleSBhcmUgdW5hd2FyZSBvZiBhbnl0aGluZyBoYXBwZW5pbmcgaW5zaWRlIHRoZSByb29tLgoKICAgICIiIgogICAgaWYgJ04nIGluIGdhbWUuY2hhcmFjdGVyczoKICAgICAgICBHQU1FX1NFVFVQICs9ICIiIkVhY2ggc2NlbmFyaW8gd2lsbCBpbmNsdWRlIG9uZSBvciBtb3JlIG9mIHRoZSBmb2xsb3dpbmcgcGxheWVyczogQSwgQiwgQywgRCwgYW5kIE4uIEEgYW5kIEIgYXJlIHRlYW1tYXRlcyBvbiB0aGUgQmx1ZSB0ZWFtLCBDIGFuZCBEIGFyZSB0ZWFtbWF0ZXMgb24gdGhlIFJlZCB0ZWFtLCBhbmQgTiBpcyBhIG5ldXRyYWwgcGFydHksIG9uIG5laXRoZXIgdGVhbS4KICAgICAgICAiIiIKICAgIGVsc2U6CiAgICAgICAgR0FNRV9TRVRVUCArPSAiIiJFYWNoIHNjZW5hcmlvIHdpbGwgaW5jbHVkZSBvbmUgb3IgbW9yZSBvZiB0aGUgZm9sbG93aW5nIHBsYXllcnM6IEEsIEIsIEMsIGFuZCBELiBBIGFuZCBCIGFyZSB0ZWFtbWF0ZXMgb24gdGhlIEJsdWUgdGVhbSwgYW5kIEMgYW5kIEQgYXJlIHRlYW1tYXRlcyBvbiB0aGUgUmVkIHRlYW0uCiAgICAgICAgIiIiCgogICAgR0FNRV9TRVRVUCArPSAiIiIKICAgIEVhY2ggdHVybiBjb25zaXN0cyBvZiBhIHNjZW5hcmlvLCBhbiBhY3Rpb24gcGhhc2UsIGFuZCBhbiBhbnN3ZXIgcGhhc2UuCgogICAgSW4gdGhlIGFuc3dlciBwaGFzZSwgSSB3aWxsIGFzayBhIHRhcmdldCBwbGF5ZXIgKG9uZSBvZiBBLCBCLCBDLCBvciBEKSB0byBuYW1lIHRoZSBjb250ZW50cyBvZiBvbmUgY29udGFpbmVyLiAKCiAgICBXaGVuIGEgcGxheWVyIGFuc3dlcnMgbXkgcXVlc3Rpb24gY29ycmVjdGx5LCB0aGVpciB0ZWFtIGdldHMgMSBwb2ludC4gVGhlIGZpcnN0IHRlYW0gdG8ge1dJTk5JTkdfU0NPUkV9IHBvaW50cyB3aW5zLgoKICAgIEJlZm9yZSB0aGF0IHBsYXllciBhbnN3ZXJzLCB0aGUgcGxheWVyIHdob3NlIHR1cm4gaXQgaXMgd2lsbCBiZSBhbGxvd2VkIHRvIHRha2Ugb25lIGFjdGlvbjogQXNrLCBUZWxsLCBvciBQYXNzLgoKICAgIEFuIEFzayBhY3Rpb24gZW50YWlscyBhc2tpbmcgb25lIHBsYXllciB0aGUgY29udGVudHMgb2Ygb25lIGNvbnRhaW5lci4gVGhlIGZvcm1hdCBmb3IgYW4gQXNrIGFjdGlvbiBpczogQXNrKFBsYXllciwgQ29udGFpbmVyKTsgdGhpcyB3aWxsIHJlc3VsdCBpbiB0aGUgcGxheWVyIHlvdSBhc2sgYW5zd2VyaW5nIHlvdXIgcXVlc3Rpb24uIEl0IGNvc3RzIHlvdXIgdGVhbSAwLjUgcG9pbnRzIHRvIGRvIHRoaXMgYWN0aW9uLgoKICAgIEEgVGVsbCBhY3Rpb24gZW50YWlscyB0ZWxsaW5nIG9uZSBwbGF5ZXIgdGhlIGNvbnRlbnRzIG9mIG9uZSBjb250YWluZXIuIFRoZSBmb3JtYXQgZm9yIGEgVGVsbCBhY3Rpb24gaXM6IFRlbGwoUGxheWVyLCBDb250YWluZXIsIENvbnRlbnRzKTsgdGhpcyB3aWxsIHJlc3VsdCBpbiB0aGUgcGxheWVyIHlvdSB0ZWxsIGhlYXJpbmcgdGhlIGFuc3dlciB5b3UgZ2l2ZS4gSXQgY29zdHMgeW91ciB0ZWFtIDAuNSBwb2ludHMgdG8gZG8gdGhpcyBhY3Rpb24uCgogICAgVGhlIGZvcm1hdCBmb3IgYSBQYXNzIGFjdGlvbiBpcyBzaW1wbHkgIlBhc3MiLiBOb3RoaW5nIGNoYW5nZXMgYXMgYSByZXN1bHQgb2YgdGhpcyBhY3Rpb24sIGFuZCBpdCBjb3N0cyAwIHBvaW50cy4KICAgICIiIgoKICAgIGlmICdOJyBpbiBnYW1lLmNoYXJhY3RlcnM6CiAgICAgICAgR0FNRV9TRVRVUCArPSAiIiJUaGUgTmV1dHJhbCBwYXJ0eSBkb2VzIG5vdCBnZXQgYW55IHR1cm5zLCBidXQgd2lsbCBhbnN3ZXIgYW55IHF1ZXN0aW9uIGhvbmVzdGx5LiIiIgogICAgCiAgICB1aS5zaG93X3NlcGFyYXRvcih0aGljaz1UcnVlKQogICAgdWkuZGlzcGxheShHQU1FX1NFVFVQLmZvcm1hdChXSU5OSU5HX1NDT1JFPWdhbWUuV0lOTklOR19TQ09SRSkpCiAgICB1aS5zaG93X3NlcGFyYXRvcih0aGljaz1UcnVlKQogICAgCiAgICB0dXJuX2NvdW50ID0gMAoKICAgIHdoaWxlIG5vdCBnYW1lLmdhbWVfb3ZlciBhbmQgZ2FtZS5nZXRfY3VycmVudF9zY2VuYXJpbygpOgogICAgICAgIHNjZW5hcmlvID0gZ2FtZS5nZXRfY3VycmVudF9zY2VuYXJpbygpCiAgICAgICAgdHVybl9jaGFyID0gZ2FtZS5nZXRfY3VycmVudF90dXJuX2NoYXJhY3RlcigpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHR1cm5fY2hhcjoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICB0cnVlX2NvbnRlbnRzID0gZ2FtZS5wcm9jZXNzX3NjZW5hcmlvX2V2ZW50cyhzY2VuYXJpbykKICAgICAgICAKICAgICAgICB1aS5kaXNwbGF5KCIiKQogICAgICAgIHVpLnNob3dfc2VwYXJhdG9yKCkKICAgICAgICB1aS5kaXNwbGF5KGYiU2NvcmU6IEJsdWU9e2dhbWUuc2NvcmVzW1RlYW0uQkxVRV19LCBSZWQ9e2dhbWUuc2NvcmVzW1RlYW0uUkVEXX0iLCBzdHlsZT0nc2NvcmUnKQogICAgICAgIGlmIHR1cm5fY291bnQgPT0gMDoKICAgICAgICAgICAgdWkuZGlzcGxheSgiSGVyZSdzIHRoZSBmaXJzdCBzY2VuYXJpbzoiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHVpLmRpc3BsYXkoZiJIZXJlJ3Mgc2NlbmFyaW8ge3R1cm5fY291bnQgKyAxfToiKQogICAgICAgIAogICAgICAgIHR1cm5fbmFtZSA9ICJZb3VyIiBpZiB0dXJuX2NoYXIgPT0gJ0EnIGVsc2UgZiJ7dHVybl9jaGFyfSdzIgogICAgICAgIHVpLmRpc3BsYXkoZiJ7dHVybl9uYW1lfSB0dXJuOiIpCiAgICAgICAgCiAgICAgICAgc2NlbmFyaW9fZGVzYyA9IHNjZW5hcmlvLmdldF9kZXNjcmlwdGlvbl9mb3IodHVybl9jaGFyLCBnYW1lLmNoYXJhY3RlcnMpCiAgICAgICAgYW5zd2VyZXIgPSAieW91IiBpZiBzY2VuYXJpby53aG9fYW5zd2VycyA9PSB0dXJuX2NoYXIgZWxzZSBzY2VuYXJpby53aG9fYW5zd2VycwogICAgICAgIHF1ZXN0aW9uX2Rlc2MgPSBmIkkgYW0gZ29pbmcgdG8gYXNrIHthbnN3ZXJlcn0gd2hhdCBpcyBpbiB0aGUge3NjZW5hcmlvLnF1ZXN0aW9uX2NvbnRhaW5lcn0uIgogICAgICAgIAogICAgICAgIHVpLmRpc3BsYXkoIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKICAgICAgICB1aS5kaXNwbGF5KHNjZW5hcmlvX2Rlc2MpCiAgICAgICAgdWkuZGlzcGxheSgiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIpCiAgICAgICAgdWkuZGlzcGxheShxdWVzdGlvbl9kZXNjKQogICAgICAgIHVpLmRpc3BsYXkoIlJlc3BvbmQgT05MWSB3aXRoIHlvdXIgYWN0aW9uLCBhbmQgbm8gb3RoZXIgdGV4dC4iKQogICAgICAgIAogICAgICAgIGFjdGlvbiA9IE5vbmUKICAgICAgICBhY3Rpb25fc3RyID0gIiIKICAgICAgICBpZiB0dXJuX2NoYXIgPT0gJ0EnOgogICAgICAgICAgICB3aGlsZSBub3QgYWN0aW9uOgogICAgICAgICAgICAgICAgYWN0aW9uX3N0ciA9IGF3YWl0IHVpLmdldF9pbnB1dCgiWW91ciBhY3Rpb24gKEFzayhQbGF5ZXIsIENvbnRhaW5lciksIFRlbGwoUGxheWVyLCBDb250YWluZXIsIENvbnRlbnRzKSwgb3IgUGFzcyk6ICIpCiAgICAgICAgICAgICAgICBhY3Rpb24gPSBnYW1lLnBhcnNlX2FjdGlvbihhY3Rpb25fc3RyKQogICAgICAgICAgICAgICAgaWYgbm90IGFjdGlvbjoKICAgICAgICAgICAgICAgICAgICB1aS5kaXNwbGF5KCJJbnZhbGlkIGFjdGlvbiBmb3JtYXQuIFRyeSBhZ2Fpbi4iLCBzdHlsZT0nZXJyb3InKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFjdGlvbiA9IGdhbWUuZXhlY3V0ZV9ucGNfYWN0aW9uKHR1cm5fY2hhciwgc2NlbmFyaW8sIHRydWVfY29udGVudHMpCiAgICAgICAgICAgIGlmIGFjdGlvbi5hY3Rpb25fdHlwZSA9PSBBY3Rpb25UeXBlLkFTSzoKICAgICAgICAgICAgICAgIGFjdGlvbl9zdHIgPSBmIkFzayh7YWN0aW9uLnRhcmdldF9jaGFyfSwge2FjdGlvbi5jb250YWluZXJ9KSIKICAgICAgICAgICAgZWxpZiBhY3Rpb24uYWN0aW9uX3R5cGUgPT0gQWN0aW9uVHlwZS5URUxMOgogICAgICAgICAgICAgICAgYWN0aW9uX3N0ciA9IGYiVGVsbCh7YWN0aW9uLnRhcmdldF9jaGFyfSwge2FjdGlvbi5jb250YWluZXJ9LCB7YWN0aW9uLmNvbnRlbnRzfSkiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhY3Rpb25fc3RyID0gIlBhc3MiCiAgICAgICAgCiAgICAgICAgc2NvcmVfZGVsdGEsIGFjdGlvbl9kZXNjID0gZ2FtZS5leGVjdXRlX2FjdGlvbih0dXJuX2NoYXIsIGFjdGlvbiwgdHJ1ZV9jb250ZW50cykKICAgICAgICAgICAgICAgIAogICAgICAgIHVpLmRpc3BsYXkoZiJcbkFjdGlvbjoge2FjdGlvbl9zdHJ9Iiwgc3R5bGU9J2FjdGlvbicpCiAgICAgICAgCiAgICAgICAgIyBBbnN3ZXIgcGhhc2UKICAgICAgICBhbnN3ZXJfZ2l2ZW4sIGlzX2NvcnJlY3QsIGFuc3dlcl9zY29yZSA9IGdhbWUucmVzb2x2ZV9hbnN3ZXJfcGhhc2Uoc2NlbmFyaW8sIHRydWVfY29udGVudHMpCiAgICAgICAgCiAgICAgICAgIyBEaXNwbGF5IGFuc3dlcgogICAgICAgIHVpLmRpc3BsYXkoZiJ7c2NlbmFyaW8ud2hvX2Fuc3dlcnN9IGFuc3dlcnM6IHthbnN3ZXJfZ2l2ZW59Iiwgc3R5bGU9J2Fuc3dlcicpCiAgICAgICAgaWYgaXNfY29ycmVjdDoKICAgICAgICAgICAgdWkuZGlzcGxheShmIkNvcnJlY3QhIFRoZSB7c2NlbmFyaW8ucXVlc3Rpb25fY29udGFpbmVyfSBjb250YWlucyB7YW5zd2VyX2dpdmVufS4iLCBzdHlsZT0nc3VjY2VzcycpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdWkuZGlzcGxheShmIkluY29ycmVjdC4gVGhlIHtzY2VuYXJpby5xdWVzdGlvbl9jb250YWluZXJ9IGFjdHVhbGx5IGNvbnRhaW5zIHt0cnVlX2NvbnRlbnRzW3NjZW5hcmlvLnF1ZXN0aW9uX2NvbnRhaW5lcl19LiIsIHN0eWxlPSdlcnJvcicpCiAgICAgICAgCiAgICAgICAgIyBDb21wdXRlIHBlci10ZWFtIGRlbHRhcwogICAgICAgIGJsdWVfZGVsdGEgPSAwLjAKICAgICAgICByZWRfZGVsdGEgPSAwLjAKCiAgICAgICAgIyBBY3Rpb24gY29zdCBhcHBsaWVzIHRvIGFjdGluZyBwbGF5ZXIncyB0ZWFtCiAgICAgICAgaWYgdHVybl9jaGFyIGluIFsnQScsICdCJ106CiAgICAgICAgICAgIGJsdWVfZGVsdGEgKz0gc2NvcmVfZGVsdGEKICAgICAgICBlbHNlOgogICAgICAgICAgICByZWRfZGVsdGEgKz0gc2NvcmVfZGVsdGEKCiAgICAgICAgIyBBbnN3ZXIgcG9pbnRzIGFwcGx5IG9ubHkgdG8gdGhlIGFuc3dlcmVyJ3MgdGVhbSAoaWYgY29ycmVjdCkKICAgICAgICBpZiBpc19jb3JyZWN0OgogICAgICAgICAgICBpZiBzY2VuYXJpby53aG9fYW5zd2VycyBpbiBbJ0EnLCAnQiddOgogICAgICAgICAgICAgICAgYmx1ZV9kZWx0YSArPSBhbnN3ZXJfc2NvcmUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJlZF9kZWx0YSArPSBhbnN3ZXJfc2NvcmUKCiAgICAgICAgIyBBcHBseSBkZWx0YXMgdG8gdGhlIHNjb3JlYm9hcmQKICAgICAgICBnYW1lLnNjb3Jlc1tUZWFtLkJMVUVdICs9IGJsdWVfZGVsdGEKICAgICAgICBnYW1lLnNjb3Jlc1tUZWFtLlJFRF0gKz0gcmVkX2RlbHRhCgogICAgICAgICMgT3V0Y29tZSBtZXNzYWdlIHNob3dzIGV4YWN0IGRlbHRhcyBmb3IgYm90aCB0ZWFtcwogICAgICAgIGRlZiBmbXRfZGVsdGEoeDogZmxvYXQpIC0+IHN0cjoKICAgICAgICAgICAgc2lnbiA9ICcrJyBpZiB4ID49IDAgZWxzZSAnLScKICAgICAgICAgICAgcmV0dXJuIGYie3NpZ259e2Ficyh4KX0iCiAgICAgICAgdWkuZGlzcGxheShmIlxuT3V0Y29tZTogQmx1ZSB7Zm10X2RlbHRhKGJsdWVfZGVsdGEpfSwgUmVkIHtmbXRfZGVsdGEocmVkX2RlbHRhKX0iKQoKICAgICAgICAjIENoZWNrIGlmIGFjdGlvbiB3YXMgb3B0aW1hbCAob25seSBmb3IgbGl2ZSBwbGF5ZXIpCiAgICAgICAgd2FzX29wdGltYWwgPSBGYWxzZQogICAgICAgIGV4cGVjdGVkX2FjdGlvbl9zdHIgPSAiIgogICAgICAgIGlmIHR1cm5fY2hhciA9PSAnQSc6CiAgICAgICAgICAgIHdhc19vcHRpbWFsID0gZ2FtZS5pc19hY3Rpb25fb3B0aW1hbChhY3Rpb25fc3RyLCBzY2VuYXJpbywgdHJ1ZV9jb250ZW50cykKICAgICAgICAgICAgZXhwZWN0ZWRfYWN0aW9uX29iaiA9IGdhbWUuZXhlY3V0ZV9ucGNfYWN0aW9uKHR1cm5fY2hhciwgc2NlbmFyaW8sIHRydWVfY29udGVudHMpCiAgICAgICAgICAgIGlmIGV4cGVjdGVkX2FjdGlvbl9vYmouYWN0aW9uX3R5cGUgPT0gQWN0aW9uVHlwZS5QQVNTOgogICAgICAgICAgICAgICAgZXhwZWN0ZWRfYWN0aW9uX3N0ciA9ICJQYXNzIgogICAgICAgICAgICBlbGlmIGV4cGVjdGVkX2FjdGlvbl9vYmouYWN0aW9uX3R5cGUgPT0gQWN0aW9uVHlwZS5BU0s6CiAgICAgICAgICAgICAgICBleHBlY3RlZF9hY3Rpb25fc3RyID0gZiJBc2soe2V4cGVjdGVkX2FjdGlvbl9vYmoudGFyZ2V0X2NoYXJ9LCB7ZXhwZWN0ZWRfYWN0aW9uX29iai5jb250YWluZXJ9KSIKICAgICAgICAgICAgZWxpZiBleHBlY3RlZF9hY3Rpb25fb2JqLmFjdGlvbl90eXBlID09IEFjdGlvblR5cGUuVEVMTDoKICAgICAgICAgICAgICAgIGV4cGVjdGVkX2FjdGlvbl9zdHIgPSBmIlRlbGwoe2V4cGVjdGVkX2FjdGlvbl9vYmoudGFyZ2V0X2NoYXJ9LCB7ZXhwZWN0ZWRfYWN0aW9uX29iai5jb250YWluZXJ9LCB7ZXhwZWN0ZWRfYWN0aW9uX29iai5jb250ZW50c30pIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdhc19vcHRpbWFsID0gVHJ1ZQogICAgICAgICAgICBleHBlY3RlZF9hY3Rpb25fc3RyID0gYWN0aW9uX3N0cgogICAgICAgIAogICAgICAgIHR1cm5fcmVjb3JkID0gVHVyblJlY29yZCgKICAgICAgICAgICAgcm91bmRfbnVtPXNjZW5hcmlvLnJvdW5kX251bSwKICAgICAgICAgICAgY2hhcmFjdGVyPXR1cm5fY2hhciwKICAgICAgICAgICAgc2NlbmFyaW9fZGVzYz1zY2VuYXJpb19kZXNjLAogICAgICAgICAgICBxdWVzdGlvbj1xdWVzdGlvbl9kZXNjLAogICAgICAgICAgICBhY3Rpb249YWN0aW9uX3N0ciwKICAgICAgICAgICAgYWN0aW9uX2Nvc3Q9YWJzKHNjb3JlX2RlbHRhKSwKICAgICAgICAgICAgYW5zd2VyX2dpdmVuPWFuc3dlcl9naXZlbiwKICAgICAgICAgICAgYW5zd2VyX2NvcnJlY3Q9aXNfY29ycmVjdCwKICAgICAgICAgICAgYW5zd2VyX3Njb3JlPWFuc3dlcl9zY29yZSwKICAgICAgICAgICAgb3B0aW1hbF9hY3Rpb249ZXhwZWN0ZWRfYWN0aW9uX3N0ciwKICAgICAgICAgICAgd2FzX29wdGltYWw9d2FzX29wdGltYWwsCiAgICAgICAgICAgIGJsdWVfc2NvcmVfYWZ0ZXI9Z2FtZS5zY29yZXNbVGVhbS5CTFVFXSwKICAgICAgICAgICAgcmVkX3Njb3JlX2FmdGVyPWdhbWUuc2NvcmVzW1RlYW0uUkVEXSwKICAgICAgICAgICAgZXBpc3RlbWljX3R5cGU9c2NlbmFyaW8uZXBpc3RlbWljX3R5cGUudmFsdWUgaWYgc2NlbmFyaW8uZXBpc3RlbWljX3R5cGUgZWxzZSBOb25lLAogICAgICAgICAgICBhc2tfY29uc3RyYWludD1zY2VuYXJpby5hc2tfY29uc3RyYWludC52YWx1ZSBpZiBzY2VuYXJpby5hc2tfY29uc3RyYWludCBlbHNlIE5vbmUKICAgICAgICApCiAgICAgICAgZ2FtZS50dXJuX3JlY29yZHMuYXBwZW5kKHR1cm5fcmVjb3JkKQogICAgICAgIAogICAgICAgICMgV2FpdCBmb3IgdXNlciB0byBjb250aW51ZQogICAgICAgIGlmIGh1bWFuX3BsYXllcjoKICAgICAgICAgICAgYXdhaXQgdWkud2FpdF9mb3JfY29udGludWUoKQogICAgICAgIAogICAgICAgIGdhbWUuYWR2YW5jZV90dXJuKCkKICAgICAgICBnYW1lLmNoZWNrX2dhbWVfb3ZlcigpCiAgICAgICAgdHVybl9jb3VudCArPSAxCgogICAgIyBHYW1lIG92ZXIKICAgIHVpLmRpc3BsYXkoIiIpCiAgICB1aS5zaG93X3NlcGFyYXRvcih0aGljaz1UcnVlKQogICAgdWkuZGlzcGxheSgiR0FNRSBPVkVSIiwgc3R5bGU9J2hlYWRlcicpCiAgICB1aS5kaXNwbGF5KGYiRmluYWwgU2NvcmU6IEJsdWUge2dhbWUuc2NvcmVzW1RlYW0uQkxVRV19IC0gUmVkIHtnYW1lLnNjb3Jlc1tUZWFtLlJFRF19Iiwgc3R5bGU9J3Njb3JlJykKICAgIGlmIGdhbWUud2lubmVyOgogICAgICAgIHVpLmRpc3BsYXkoZiJXaW5uZXI6IHtnYW1lLndpbm5lci52YWx1ZX0gdGVhbSIsIHN0eWxlPSdzdWNjZXNzJykKICAgIGVsaWYgZ2FtZS53aW5uZXIgaXMgTm9uZToKICAgICAgICB1aS5kaXNwbGF5KCJJdCdzIGEgdGllISIpCiAgICB1aS5zaG93X3NlcGFyYXRvcih0aGljaz1UcnVlKQogICAgCiAgICBmb3IgcmVjb3JkIGluIGdhbWUudHVybl9yZWNvcmRzOgogICAgICAgIGlmIHJlY29yZC5jaGFyYWN0ZXIgPT0gJ0EnOgogICAgICAgICAgICB1aS5kaXNwbGF5KGYiXG5Sb3VuZCB7cmVjb3JkLnJvdW5kX251bX0gLSB7cmVjb3JkLmNoYXJhY3Rlcn0ncyB0dXJuIikKICAgICAgICAgICAgdWkuZGlzcGxheShmIk9udG9sb2dpY2FsIFR5cGU6IHtyZWNvcmQuZXBpc3RlbWljX3R5cGV9LCBBc2sgQ29uc3RyYWludDoge3JlY29yZC5hc2tfY29uc3RyYWludH0iKQogICAgICAgICAgICB1aS5kaXNwbGF5KGYiQWN0aW9uOiB7cmVjb3JkLmFjdGlvbn0sIEV4cGVjdGVkOiB7cmVjb3JkLm9wdGltYWxfYWN0aW9ufSIpCgogICAgIyBTYXZlIHJlc3VsdHMKICAgIHNhdmVfZ2FtZV9yZXN1bHRzKGdhbWUudHVybl9yZWNvcmRzLCAnZ2FtZV9yZXN1bHRzLmpzb24nKQogICAgdWkuZGlzcGxheSgiXG5HYW1lIHJlc3VsdHMgc2F2ZWQgdG8gZ2FtZV9yZXN1bHRzLmpzb24iKQogICAgCiAgICByZXR1cm4gZ2FtZQo=").decode('utf-8')

# Write them as actual .py files so Python can import them normally
with open('tom_helpers.py', 'w') as f:
    f.write(tom_helpers_code)

with open('game_ui.py', 'w') as f:
    f.write(game_ui_code)

with open('tom_test.py', 'w') as f:
    f.write(game_logic_code)

with open('scenarios.json', 'w') as f:
    json.dump(scenarios_data, f)

# Hide loading message
from js import document
document.getElementById('loading').style.display = 'none'

# Now import normally - this will work because they're real files
from tom_test import play_game_cli
from game_ui import BrowserInterface

# Run the game - top-level await works here
await play_game_cli(scenario_file='scenarios.json', human_player=True, ui=BrowserInterface())

    </script>
</body>
</html>
